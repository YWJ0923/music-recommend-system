{"ast":null,"code":"import _slicedToArray from\"D:/Programming/Project/Music_Recommend_System/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useRef}from'react';import{StepBackwardOutlined,StepForwardOutlined,CaretRightOutlined,PauseOutlined,UnorderedListOutlined,HeartOutlined,PlusCircleOutlined}from'@ant-design/icons';import{Button,Dropdown,Menu,Modal,Image,Form,Input,Slider}from'antd';import PubSub from'pubsub-js';import axios from'axios';import{Link}from'react-router-dom';import{observer,useLocalObservable}from'mobx-react';import{getToken}from'../../utils/auth';import{SERVER_URL}from'../../utils/constant';import{playBarStore}from\"../../stores/playBarStore\";import{showNotification}from\"../../utils/common\";import{getPlayUrl}from\"../../utils/play\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function PlayBar(props){var _useLocalObservable=useLocalObservable(function(){return playBarStore;}),playList=_useLocalObservable.playList,index=_useLocalObservable.index,setIndex=_useLocalObservable.setIndex,playUrl=_useLocalObservable.playUrl;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),isPaused=_useState2[0],setIsPaused=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),currentTime=_useState4[0],setCurrentTime=_useState4[1];var _useState5=useState(undefined),_useState6=_slicedToArray(_useState5,2),beginTime=_useState6[0],setBeginTime=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),duration=_useState8[0],setDuration=_useState8[1];var _useState9=useState(0.3),_useState10=_slicedToArray(_useState9,2),volume=_useState10[0],setVolume=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),collectionList=_useState12[0],setCollectionList=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isCollectionListModalVisible=_useState14[0],setIsCollectionListModalVisible=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),isNewCollectionListModalVisible=_useState16[0],setIsNewCollectionListModalVisible=_useState16[1];var audio1=useRef();useEffect(function(){PubSub.subscribe('showNewCollectionListModal',showNewCollectionListModal);PubSub.subscribe('addPlayTimes',addPlayTimes);return function(){PubSub.unsubscribe('showNewCollectionListModal');PubSub.unsubscribe('addPlayTimes');};// eslint-disable-next-line\n},[]);var playBackward=function playBackward(){addPlayTimes();if(playList.length===1){audio1.current.currentTime=0;audio1.current.play();}else{var newIndex=(index-1+playList.length)%playList.length;getPlayUrl(playList[newIndex]);setIndex(newIndex);}};var playOrPause=function playOrPause(){isPaused?audio1.current.play():audio1.current.pause();setIsPaused(!isPaused);};var playForward=function playForward(){addPlayTimes();if(playList.length===1){audio1.current.currentTime=0;audio1.current.play();}else{var newIndex=(index+1)%playList.length;getPlayUrl(playList[newIndex]);setIndex(newIndex);}};// 播放列表切换歌\nvar changeMusic=function changeMusic(obj){// console.log(obj.key);\naddPlayTimes();var newIndex=playList.findIndex(function(music){return music.musicId===obj.key;});if(newIndex!==index){getPlayUrl(playList[newIndex]);setIndex(newIndex);}// console.log(newIndex);\n};// 播放列表\nvar createPlayList=function createPlayList(){if(playList[index]){return/*#__PURE__*/_jsxs(Menu,{selectedKeys:[playList[index].musicId],onClick:changeMusic,style:{width:'800px',height:'300px',overflow:'scroll',overflowX:'hidden'},children:[/*#__PURE__*/_jsxs(Menu.Item,{style:{width:'750px'},children:[\"\\u64AD\\u653E\\u5217\\u8868 (\",playList.length,\")\"]},\"title\"),/*#__PURE__*/_jsx(Menu.Divider,{}),playList.map(function(music){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Menu.Item,{children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'450px'},children:music.musicName}),/*#__PURE__*/_jsx(\"div\",{style:{width:'250px'},children:music.artistName}),/*#__PURE__*/_jsx(\"div\",{style:{width:'50px'},children:parseTime(music.timeLength/1000)})]})},music.musicId),/*#__PURE__*/_jsx(Menu.Divider,{})]});})]});}else{return/*#__PURE__*/_jsxs(Menu,{children:[/*#__PURE__*/_jsxs(Menu.Item,{style:{width:'650px'},children:[\"\\u64AD\\u653E\\u5217\\u8868 (\",playList.length,\")\"]},\"title\"),/*#__PURE__*/_jsx(Menu.Divider,{})]});}};// 音乐加载完毕，可以播放\nvar canPlay=function canPlay(){setIsPaused(false);setBeginTime(new Date().getTime());console.log(beginTime);setDuration(audio1.current.duration);audio1.current.play();};// audio更新state时间\nvar updatePlayTime=function updatePlayTime(){setCurrentTime(audio1.current.currentTime);};// 停留时间超过30秒，增加播放量、用户播放量，换歌的时候执行，添加用户评分\nvar addPlayTimes=function addPlayTimes(){if(playList[index]){var endTime=new Date().getTime();// console.log(beginTime);\n// console.log(endTime);\nif(endTime-beginTime>=30000){axios({method:'POST',url:SERVER_URL+'play_times/'+playList[index].musicId}).then(function(response){console.log(response.data);});if(props.user){axios({method:'POST',url:SERVER_URL+'user/play_times/'+playList[index].musicId,headers:{Authorization:getToken()},data:{time_length:endTime-beginTime}}).then(function(response){if(response.data.status===401){PubSub.publish('logout');}});}}}};// 拖动条改变时间\nvar changePlayTime=function changePlayTime(value){audio1.current.currentTime=value;};// 解析时间成00:00格式, time以秒为单位\nvar parseTime=function parseTime(time){var min=Math.floor(time/60);if(min<10){min='0'+min;}var sec=Math.floor(time%60);if(sec<10){sec='0'+sec;}return min+':'+sec;};// audio更新音量\nvar updateVolume=function updateVolume(){setVolume(audio1.current.volume);};// 静音或者音量最大\nvar mute=function mute(){audio1.current.volume=audio1.current.volume>0?0:1;};// 拖动条改变音量\nvar changeVolume=function changeVolume(value){audio1.current.volume=value;};var showCollectionListModal=function showCollectionListModal(){if(!props.user){PubSub.publish('showLoginModal');}else{axios({method:'GET',url:SERVER_URL+'collection_list',headers:{Authorization:getToken()}}).then(function(response){if(response.data.status!==200){PubSub.publish('logout');PubSub.publish('showLoginModal');}else{setCollectionList(response.data.data);setIsCollectionListModalVisible(true);}});}};var closeCollectionListModal=function closeCollectionListModal(){setIsCollectionListModalVisible(false);};var showNewCollectionListModal=function showNewCollectionListModal(){setIsCollectionListModalVisible(false);setIsNewCollectionListModalVisible(true);};var closeNewCollectionListModal=function closeNewCollectionListModal(){setIsNewCollectionListModalVisible(false);};var handleCollection=function handleCollection(obj){if(playList[index]){if(obj.key==='newList'){showNewCollectionListModal();}else{insertMusicToCollectionList(obj.key,playList[index].musicId);}}closeCollectionListModal();};var insertMusicToCollectionList=function insertMusicToCollectionList(collectionListId,musicId){axios({method:'POST',url:SERVER_URL+'collection_list/'+collectionListId+'/'+musicId,headers:{Authorization:getToken()}}).then(function(response){if(response.data.status===401){PubSub.publish('logout');}showNotification(response.data.message);});};var insertCollectionList=function insertCollectionList(values){axios({method:'POST',url:SERVER_URL+'collection_list/'+values.collectionListName,headers:{Authorization:getToken()}}).then(function(response){if(response.data.status===401){PubSub.publish('logout');}else if(response.data.status===200){PubSub.publish('getCollectionList');}showNotification(response.data.message);});closeNewCollectionListModal();};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',left:0,bottom:0,height:'60px',backgroundColor:'black',width:'100%'},id:\"playbar\",children:/*#__PURE__*/_jsxs(\"div\",{style:{margin:'5px auto',width:'1000px',display:'flex'},children:[/*#__PURE__*/_jsx(Button,{shape:\"circle\",style:{backgroundColor:'black',margin:'auto 5px',borderWidth:'2px'},onClick:playBackward,children:/*#__PURE__*/_jsx(StepBackwardOutlined,{style:{color:'white',fontSize:'25px',marginTop:'-2px'}})}),/*#__PURE__*/_jsx(Button,{shape:\"circle\",style:{backgroundColor:'black',margin:'auto 5px',borderWidth:'2px'},onClick:playOrPause,size:\"large\",children:isPaused?/*#__PURE__*/_jsx(CaretRightOutlined,{style:{color:'white',fontSize:'32px',marginLeft:'4px',marginTop:'-4px'}}):/*#__PURE__*/_jsx(PauseOutlined,{style:{color:'white',fontSize:'32px',marginLeft:'0',marginTop:'-4.5px'}})}),/*#__PURE__*/_jsx(Button,{shape:\"circle\",style:{backgroundColor:'black',margin:'auto 5px',borderWidth:'2px'},onClick:playForward,children:/*#__PURE__*/_jsx(StepForwardOutlined,{style:{color:'white',fontSize:'25px',marginTop:'-2px'}})}),playList[index]?/*#__PURE__*/_jsx(Link,{to:\"/album/\".concat(playList[index].albumId),children:/*#__PURE__*/_jsx(\"img\",{alt:playList[index].musicName,src:playList[index].albumImg,style:{width:'50px',height:'50px',margin:'0 10px'}})}):/*#__PURE__*/_jsx(\"img\",{alt:\"718\\u97F3\\u4E50\",src:\"/favicon.ico\",style:{width:'50px',height:'50px',margin:'0 10px'}}),/*#__PURE__*/_jsxs(\"div\",{style:{width:'550px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{color:'#e8e8e8'},children:[playList[index]?playList[index].musicName:'718音乐',playList[index]&&/*#__PURE__*/_jsx(Link,{to:\"/artist/\".concat(playList[index].artistId),style:{color:'#9b9b9b'},children:/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'10px',marginLeft:'20px'},children:playList[index].artistName})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"barAndTime\",style:{marginTop:'8px',width:'550px',display:'flex'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"bar\",style:{width:'450px',height:'10px',marginTop:'7px',display:'flex'},children:/*#__PURE__*/_jsx(Slider,{max:duration,value:currentTime,style:{height:'10px',width:'450px',marginTop:'-1px',marginLeft:'-1px'},onChange:changePlayTime,tooltipVisible:false})}),/*#__PURE__*/_jsxs(\"div\",{className:\"time\",style:{color:'white',marginLeft:'5px'},children:[parseTime(currentTime),\"/\",parseTime(duration)]})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{margin:'auto 5px'},children:/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(HeartOutlined,{}),title:\"\\u6536\\u85CF\",ghost:true,size:\"small\",style:{border:'0'},onClick:showCollectionListModal})}),/*#__PURE__*/_jsx(Dropdown,{overlay:createPlayList,placement:\"topCenter\",arrow:true,getPopupContainer:function getPopupContainer(){return document.getElementById('playbar');},children:/*#__PURE__*/_jsx(Button,{style:{marginTop:'10px',border:'0'},icon:/*#__PURE__*/_jsx(UnorderedListOutlined,{}),ghost:true})}),/*#__PURE__*/_jsxs(\"div\",{className:\"volumeCtrl\",style:{marginLeft:'10px',display:'flex'},children:[/*#__PURE__*/_jsx(Button,{icon:volume!==0?/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-volume-up\"}):/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-volume-off\"}),style:{marginTop:'10px',border:'0'},ghost:true,onClick:mute}),/*#__PURE__*/_jsx(Slider,{max:1,value:volume,onChange:changeVolume,step:0.01,style:{width:'100px',marginTop:'20px'},tooltipVisible:false})]})]})}),/*#__PURE__*/_jsx(\"audio\",{src:playUrl,proload:\"auto\",onCanPlay:canPlay,onTimeUpdate:updatePlayTime,onVolumeChange:updateVolume,onEnded:playForward,ref:audio1}),/*#__PURE__*/_jsx(Modal,{title:\"\\u6DFB\\u52A0\\u5230\\u6B4C\\u5355\",onCancel:closeCollectionListModal,visible:isCollectionListModalVisible,okText:\"\\u786E\\u8BA4\",cancelText:\"\\u53D6\\u6D88\",footer:null,children:/*#__PURE__*/_jsxs(Menu,{onClick:handleCollection,style:{width:'480px',height:'400px',overflow:'scroll',overflowX:'hidden'},defaultSelectedKeys:\"newList\",children:[/*#__PURE__*/_jsx(Menu.Item,{icon:/*#__PURE__*/_jsx(PlusCircleOutlined,{}),children:\"\\u521B\\u5EFA\\u65B0\\u6B4C\\u5355\"},\"newList\"),/*#__PURE__*/_jsx(Menu.Divider,{}),collectionList.map(function(list){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Menu.Item,{style:{height:'50px'},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex'},children:[/*#__PURE__*/_jsx(Image,{style:{width:'50px',height:'50px'},src:list.collectionListImg}),/*#__PURE__*/_jsx(\"div\",{style:{width:'250px',margin:'auto 20px'},children:list.collectionListName}),/*#__PURE__*/_jsx(\"div\",{style:{width:'100px',margin:'auto 10px'},children:list.collectionListLength+'首'})]})},list.collectionListId),/*#__PURE__*/_jsx(Menu.Divider,{})]});})]})}),/*#__PURE__*/_jsx(Modal,{title:\"\\u521B\\u5EFA\\u65B0\\u6B4C\\u5355\",onCancel:closeNewCollectionListModal,visible:isNewCollectionListModalVisible,footer:null,children:/*#__PURE__*/_jsxs(Form,{onFinish:insertCollectionList,children:[/*#__PURE__*/_jsx(Form.Item,{label:\"\\u6B4C\\u5355\\u540D\",name:\"collectionListName\",rules:[{required:true,message:'歌单名不能为空'}],children:/*#__PURE__*/_jsx(Input,{})}),/*#__PURE__*/_jsx(Form.Item,{wrapperCol:{offset:8,span:16},children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",children:\"\\u65B0\\u5EFA\"})})]})})]});}export default observer(PlayBar);","map":{"version":3,"sources":["D:/Programming/Project/Music_Recommend_System/client/src/components/PlayBar/index.jsx"],"names":["React","useEffect","useState","useRef","StepBackwardOutlined","StepForwardOutlined","CaretRightOutlined","PauseOutlined","UnorderedListOutlined","HeartOutlined","PlusCircleOutlined","Button","Dropdown","Menu","Modal","Image","Form","Input","Slider","PubSub","axios","Link","observer","useLocalObservable","getToken","SERVER_URL","playBarStore","showNotification","getPlayUrl","PlayBar","props","playList","index","setIndex","playUrl","isPaused","setIsPaused","currentTime","setCurrentTime","undefined","beginTime","setBeginTime","duration","setDuration","volume","setVolume","collectionList","setCollectionList","isCollectionListModalVisible","setIsCollectionListModalVisible","isNewCollectionListModalVisible","setIsNewCollectionListModalVisible","audio1","subscribe","showNewCollectionListModal","addPlayTimes","unsubscribe","playBackward","length","current","play","newIndex","playOrPause","pause","playForward","changeMusic","obj","findIndex","music","musicId","key","createPlayList","width","height","overflow","overflowX","map","display","musicName","artistName","parseTime","timeLength","canPlay","Date","getTime","console","log","updatePlayTime","endTime","method","url","then","response","data","user","headers","Authorization","time_length","status","publish","changePlayTime","value","time","min","Math","floor","sec","updateVolume","mute","changeVolume","showCollectionListModal","closeCollectionListModal","closeNewCollectionListModal","handleCollection","insertMusicToCollectionList","collectionListId","message","insertCollectionList","values","collectionListName","position","left","bottom","backgroundColor","margin","borderWidth","color","fontSize","marginTop","marginLeft","albumId","albumImg","artistId","border","document","getElementById","list","collectionListImg","collectionListLength","required","offset","span"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react'\r\nimport {StepBackwardOutlined, StepForwardOutlined, CaretRightOutlined, PauseOutlined, UnorderedListOutlined, HeartOutlined, PlusCircleOutlined} from '@ant-design/icons';\r\nimport { Button, Dropdown, Menu, Modal, Image, Form, Input, Slider } from 'antd'\r\nimport PubSub from 'pubsub-js';\r\nimport axios from 'axios';\r\nimport { Link } from 'react-router-dom';\r\nimport {observer, useLocalObservable} from 'mobx-react';\r\nimport { getToken } from '../../utils/auth';\r\nimport { SERVER_URL } from '../../utils/constant';\r\nimport {playBarStore} from \"../../stores/playBarStore\";\r\nimport {showNotification} from \"../../utils/common\";\r\nimport {getPlayUrl} from \"../../utils/play\";\r\n\r\nfunction PlayBar(props) {\r\n    const {playList, index, setIndex, playUrl} = useLocalObservable(() => playBarStore);\r\n\r\n    const [isPaused, setIsPaused] = useState(true);\r\n    const [currentTime, setCurrentTime] = useState(0);\r\n    const [beginTime, setBeginTime] = useState(undefined);\r\n    const [duration, setDuration] = useState(0);\r\n    const [volume, setVolume] = useState(0.3);\r\n    const [collectionList, setCollectionList] = useState([]);\r\n    const [isCollectionListModalVisible, setIsCollectionListModalVisible] = useState(false);\r\n    const [isNewCollectionListModalVisible, setIsNewCollectionListModalVisible] = useState(false);\r\n\r\n    const audio1 = useRef();\r\n\r\n    useEffect(() => {\r\n        PubSub.subscribe('showNewCollectionListModal', showNewCollectionListModal);\r\n        PubSub.subscribe('addPlayTimes', addPlayTimes);\r\n        return () => {\r\n            PubSub.unsubscribe('showNewCollectionListModal');\r\n            PubSub.unsubscribe('addPlayTimes');\r\n        }  // eslint-disable-next-line\r\n    }, []);\r\n\r\n    const playBackward = () => {\r\n        addPlayTimes();\r\n        if (playList.length === 1) {\r\n            audio1.current.currentTime = 0\r\n            audio1.current.play();\r\n        }\r\n        else {\r\n            const newIndex = (index - 1 + playList.length) % playList.length;\r\n            getPlayUrl(playList[newIndex]);\r\n            setIndex(newIndex);\r\n        }\r\n    }\r\n    \r\n    const playOrPause = () => {\r\n        isPaused ? audio1.current.play() : audio1.current.pause();\r\n        setIsPaused(!isPaused);\r\n    }\r\n\r\n    const playForward = () => {\r\n        addPlayTimes();\r\n        if (playList.length === 1) {\r\n            audio1.current.currentTime = 0\r\n            audio1.current.play();\r\n        }\r\n        else {\r\n            const newIndex = (index + 1) % playList.length;\r\n            getPlayUrl(playList[newIndex]);\r\n            setIndex(newIndex);\r\n        }\r\n    }\r\n\r\n    // 播放列表切换歌\r\n    const changeMusic = (obj) => {\r\n        // console.log(obj.key);\r\n        addPlayTimes();\r\n        const newIndex = playList.findIndex((music) => {\r\n            return music.musicId === obj.key;\r\n        });\r\n        if (newIndex !== index) {\r\n            getPlayUrl(playList[newIndex]);\r\n            setIndex(newIndex);\r\n        }\r\n        // console.log(newIndex);\r\n    }\r\n\r\n    // 播放列表\r\n    const createPlayList = () => {\r\n        if (playList[index]) {\r\n            return (\r\n                <Menu selectedKeys={[playList[index].musicId]} onClick={changeMusic} style={{width: '800px', height: '300px', overflow: 'scroll', overflowX: 'hidden'}}>\r\n                    <Menu.Item key=\"title\" style={{width: '750px'}}>播放列表 ({playList.length})</Menu.Item>\r\n                    <Menu.Divider />\r\n                    {playList.map((music) => {\r\n                        return (\r\n                            <>\r\n                                <Menu.Item key={music.musicId}>\r\n                                    <div style={{display: 'flex'}}>\r\n                                        <div style={{width: '450px'}}>{music.musicName}</div>\r\n                                        <div style={{width: '250px'}}>{music.artistName}</div>\r\n                                        <div style={{width: '50px'}}>{parseTime(music.timeLength / 1000)}</div>\r\n                                    </div>\r\n                                </Menu.Item>\r\n                                <Menu.Divider />\r\n                            </>\r\n                        );\r\n                    })}\r\n                </Menu>\r\n            );\r\n        } else {\r\n            return (\r\n                <Menu>\r\n                    <Menu.Item key=\"title\" style={{width: '650px'}}>播放列表 ({playList.length})</Menu.Item>\r\n                    <Menu.Divider />\r\n                </Menu>\r\n            );\r\n        }\r\n        \r\n    }\r\n\r\n    // 音乐加载完毕，可以播放\r\n    const canPlay = () => {\r\n        setIsPaused(false);\r\n        setBeginTime(new Date().getTime());\r\n        console.log(beginTime);\r\n        setDuration(audio1.current.duration);\r\n        audio1.current.play();\r\n    }\r\n\r\n    // audio更新state时间\r\n    const updatePlayTime = () => {\r\n        setCurrentTime(audio1.current.currentTime);\r\n    }\r\n\r\n    // 停留时间超过30秒，增加播放量、用户播放量，换歌的时候执行，添加用户评分\r\n    const addPlayTimes = () => {\r\n        if (playList[index]) {\r\n            const endTime = new Date().getTime();\r\n            // console.log(beginTime);\r\n            // console.log(endTime);\r\n            if (endTime - beginTime >= 30000) {\r\n                axios({\r\n                    method: 'POST',\r\n                    url: SERVER_URL +  'play_times/' + playList[index].musicId\r\n                }).then((response) => {\r\n                    console.log(response.data);\r\n                });\r\n                if (props.user) {\r\n                    axios({\r\n                        method: 'POST',\r\n                        url: SERVER_URL +  'user/play_times/' + playList[index].musicId,\r\n                        headers: {\r\n                            Authorization: getToken()\r\n                        },\r\n                        data: {\r\n                            time_length: endTime - beginTime\r\n                        }\r\n                    }).then((response) => {\r\n                        if (response.data.status === 401) {\r\n                            PubSub.publish('logout');\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    // 拖动条改变时间\r\n    const changePlayTime = (value) => {\r\n        audio1.current.currentTime = value;\r\n    }\r\n    \r\n    // 解析时间成00:00格式, time以秒为单位\r\n    const parseTime = (time) => {\r\n        var min = Math.floor(time / 60);\r\n        if (min < 10) {\r\n            min = '0' + min;\r\n        }\r\n        var sec = Math.floor(time % 60);\r\n        if (sec < 10) {\r\n            sec = '0' + sec;\r\n        }\r\n        return min + ':' + sec;\r\n    }\r\n    \r\n    // audio更新音量\r\n    const updateVolume = () => {\r\n        setVolume(audio1.current.volume);\r\n    }\r\n\r\n    // 静音或者音量最大\r\n    const mute = () => {\r\n        audio1.current.volume = audio1.current.volume > 0 ? 0 : 1;\r\n    }\r\n\r\n    // 拖动条改变音量\r\n    const changeVolume = (value) => {\r\n        audio1.current.volume = value;\r\n    }\r\n\r\n    const showCollectionListModal = () => {\r\n        if (!props.user) {\r\n            PubSub.publish('showLoginModal');\r\n        } else{\r\n            axios({\r\n                method: 'GET',\r\n                url: SERVER_URL + 'collection_list',\r\n                headers: {\r\n                    Authorization: getToken()\r\n                }\r\n            }).then((response) => {\r\n                if (response.data.status !== 200) {\r\n                    PubSub.publish('logout');\r\n                    PubSub.publish('showLoginModal');\r\n                } else{\r\n                    setCollectionList(response.data.data);\r\n                    setIsCollectionListModalVisible(true);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    const closeCollectionListModal = () => {\r\n        setIsCollectionListModalVisible(false);\r\n    }\r\n\r\n    const showNewCollectionListModal = () => {\r\n        setIsCollectionListModalVisible(false);\r\n        setIsNewCollectionListModalVisible(true);\r\n    }\r\n\r\n    const closeNewCollectionListModal = () => {\r\n        setIsNewCollectionListModalVisible(false);\r\n    }\r\n\r\n    const handleCollection = (obj) => {\r\n        if (playList[index]) {\r\n            if (obj.key === 'newList') {\r\n                showNewCollectionListModal();\r\n            } else {\r\n                insertMusicToCollectionList(obj.key, playList[index].musicId);\r\n            }\r\n        }\r\n        closeCollectionListModal();\r\n    }\r\n\r\n    const insertMusicToCollectionList = (collectionListId, musicId) => {\r\n        axios({\r\n            method: 'POST',\r\n            url: SERVER_URL + 'collection_list/' + collectionListId + '/' + musicId,\r\n            headers: {\r\n                Authorization: getToken()\r\n            }\r\n        }).then((response) => {\r\n            if (response.data.status === 401) {\r\n                PubSub.publish('logout');\r\n            }\r\n            showNotification(response.data.message);\r\n        })\r\n    }\r\n\r\n    const insertCollectionList = (values) => {\r\n        axios({\r\n            method: 'POST',\r\n            url: SERVER_URL + 'collection_list/' + values.collectionListName,\r\n            headers: {\r\n                Authorization: getToken()\r\n            }\r\n        }).then((response) => {\r\n            if (response.data.status === 401) {\r\n                PubSub.publish('logout');\r\n            } else if (response.data.status === 200) {\r\n                PubSub.publish('getCollectionList');\r\n            }\r\n            showNotification(response.data.message);\r\n        });\r\n        closeNewCollectionListModal();\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <div style={{position: 'fixed', left: 0, bottom: 0, height: '60px', backgroundColor: 'black', width: '100%'}} id=\"playbar\">\r\n                <div style={{margin: '5px auto', width: '1000px', display: 'flex'}}>\r\n                    <Button shape='circle' style={{backgroundColor: 'black', margin: 'auto 5px', borderWidth: '2px'}} onClick={playBackward}>\r\n                        <StepBackwardOutlined style={{color: 'white', fontSize: '25px', marginTop: '-2px'}} />\r\n                    </Button>\r\n                    <Button shape='circle' style={{backgroundColor: 'black', margin: 'auto 5px', borderWidth: '2px'}} onClick={playOrPause} size=\"large\">\r\n                        {isPaused ? <CaretRightOutlined style={{color: 'white', fontSize: '32px', marginLeft: '4px', marginTop: '-4px'}} /> : <PauseOutlined style={{color: 'white', fontSize: '32px', marginLeft: '0', marginTop: '-4.5px'}} />}\r\n                    </Button>\r\n                    <Button shape='circle' style={{backgroundColor: 'black', margin: 'auto 5px', borderWidth: '2px'}} onClick={playForward}>\r\n                        <StepForwardOutlined style={{color: 'white', fontSize: '25px', marginTop: '-2px'}} />\r\n                    </Button>\r\n                    {playList[index] ? \r\n                    <Link to={`/album/${playList[index].albumId}`}>\r\n                        <img alt={playList[index].musicName} src={playList[index].albumImg} style={{width: '50px', height: '50px', margin: '0 10px'}} />\r\n                    </Link> \r\n                    : <img alt=\"718音乐\" src=\"/favicon.ico\" style={{width: '50px', height: '50px', margin: '0 10px'}} />}\r\n                    <div style={{width: '550px'}}>\r\n                        <div style={{color: '#e8e8e8'}}>\r\n                            {playList[index] ? playList[index].musicName : '718音乐'}\r\n                            {playList[index] && <Link to={`/artist/${playList[index].artistId}`} style={{color: '#9b9b9b'}}><span style={{fontSize: '10px', marginLeft: '20px'}}>{playList[index].artistName}</span></Link>}\r\n                        </div>\r\n                        <div className=\"barAndTime\" style={{marginTop: '8px', width: '550px', display: 'flex'}}>\r\n                            <div className=\"bar\" style={{width: '450px', height: '10px', marginTop: '7px', display: 'flex'}}>\r\n                                {/* <input type=\"range\" max={duration} value={currentTime} style={{backgroundColor: 'red', height: '10px', width: '450px', marginBottom: '5px'}} onChange={changePlayTime} /> */}\r\n                                <Slider max={duration} value={currentTime} style={{height: '10px', width: '450px', marginTop: '-1px', marginLeft: '-1px'}} onChange={changePlayTime} tooltipVisible={false} />\r\n                            </div>\r\n                            <div className=\"time\" style={{color: 'white', marginLeft: '5px'}}>{parseTime(currentTime)}/{parseTime(duration)}</div>\r\n                        </div>\r\n                    </div>\r\n                    <div style={{margin: 'auto 5px'}}>\r\n                        <Button icon={<HeartOutlined />} title=\"收藏\" ghost size=\"small\" style={{border: '0'}} onClick={showCollectionListModal} />\r\n                    </div>\r\n                    <Dropdown overlay={createPlayList} placement=\"topCenter\" arrow getPopupContainer={() => document.getElementById('playbar')}>\r\n                        <Button style={{marginTop: '10px', border: '0'}} icon={<UnorderedListOutlined />} ghost />\r\n                    </Dropdown>\r\n                    <div className=\"volumeCtrl\" style={{marginLeft: '10px', display: 'flex'}}>\r\n                        <Button icon={volume !== 0 ? <i className=\"fa fa-volume-up\"></i> : <i className=\"fa fa-volume-off\"></i>} style={{marginTop: '10px', border: '0'}} ghost onClick={mute} />\r\n                        {/* <input type=\"range\" step=\"0.01\" max=\"1\" value={volume} onChange={changeVolume} /> */}\r\n                        <Slider max={1} value={volume} onChange={changeVolume} step={0.01} style={{width: '100px', marginTop: '20px'}} tooltipVisible={false} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <audio src={playUrl} proload=\"auto\" onCanPlay={canPlay} onTimeUpdate={updatePlayTime} onVolumeChange={updateVolume} onEnded={playForward} ref={audio1} />\r\n            <Modal title=\"添加到歌单\" onCancel={closeCollectionListModal} visible={isCollectionListModalVisible} okText=\"确认\" cancelText=\"取消\" footer={null}>\r\n                <Menu onClick={handleCollection} style={{width: '480px', height: '400px', overflow: 'scroll', overflowX: 'hidden'}} defaultSelectedKeys=\"newList\">\r\n                    <Menu.Item key=\"newList\" icon={<PlusCircleOutlined />}>\r\n                        创建新歌单\r\n                    </Menu.Item>\r\n                    <Menu.Divider />\r\n                    {collectionList.map((list) => {\r\n                        return (\r\n                            <>\r\n                                <Menu.Item key={list.collectionListId} style={{height: '50px'}}>\r\n                                    <div style={{display: 'flex'}}>\r\n                                        <Image style={{width: '50px', height: '50px'}} src={list.collectionListImg} />\r\n                                        <div style={{width: '250px', margin: 'auto 20px'}}>{list.collectionListName}</div>\r\n                                        <div style={{width: '100px', margin: 'auto 10px'}}>{list.collectionListLength + '首'}</div>\r\n                                    </div>\r\n                                </Menu.Item>\r\n                                <Menu.Divider />\r\n                            </>\r\n                        );\r\n                    })}\r\n                </Menu> \r\n            </Modal>\r\n            <Modal title=\"创建新歌单\" onCancel={closeNewCollectionListModal} visible={isNewCollectionListModalVisible} footer={null}>\r\n                <Form onFinish={insertCollectionList}>\r\n                    <Form.Item label=\"歌单名\" name=\"collectionListName\" rules={[{ required: true, message: '歌单名不能为空' }]}>\r\n                        <Input />\r\n                    </Form.Item>\r\n                    <Form.Item wrapperCol={{ offset: 8, span: 16 }}>\r\n                        <Button type=\"primary\" htmlType=\"submit\">新建</Button>\r\n                    </Form.Item>\r\n                </Form>\r\n            </Modal>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default observer(PlayBar);\r\n"]},"metadata":{},"sourceType":"module"}