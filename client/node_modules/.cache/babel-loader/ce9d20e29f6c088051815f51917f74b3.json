{"ast":null,"code":"import _slicedToArray from\"D:/Programming/Project/Music_Recommend_System/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from'react';import{Button,Menu,Input,Modal,Form,Checkbox,Dropdown,Layout}from'antd';import{withRouter}from'react-router-dom';import'antd/dist/antd.min.css';import{LockOutlined,UserOutlined,LogoutOutlined}from'@ant-design/icons';import axios from'axios';import PubSub from'pubsub-js';import{SERVER_URL}from\"../../utils/constant\";import{getToken}from\"../../utils/auth\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Header=Layout.Header;var Search=Input.Search;function MyHeader(props){var _this=this;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoginModalVisible=_useState2[0],setIsLoginModalVisible=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isRegisterModalVisible=_useState4[0],setIsRegisterModalVisible=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isTagModalVisible=_useState6[0],setIsTagModalVisible=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),tagList=_useState8[0],setTagList=_useState8[1];useEffect(function(){PubSub.subscribe('showLoginModal',showLoginModal);return function(){PubSub.unsubscribe('showLoginModal');};// eslint-disable-next-line\n},[]);var alert1=useRef(null);var alert2=useRef(null);var handleClickUserMenu=function handleClickUserMenu(obj){if(obj.key==='logout'){PubSub.publish('logout');}};var userMenu=function userMenu(){return/*#__PURE__*/_jsxs(Menu,{onClick:handleClickUserMenu,children:[/*#__PURE__*/_jsx(Menu.Item,{icon:/*#__PURE__*/_jsx(UserOutlined,{}),children:\"\\u6211\\u7684\\u4E3B\\u9875\"},\"home\"),/*#__PURE__*/_jsx(Menu.Item,{icon:/*#__PURE__*/_jsx(LogoutOutlined,{}),children:\"\\u9000\\u51FA\"},\"logout\")]});};var showLoginModal=function showLoginModal(){closeRegisterModal();setIsLoginModalVisible(true);};var closeLoginModal=function closeLoginModal(){setIsLoginModalVisible(false);};var showRegisterModal=function showRegisterModal(){closeLoginModal();setIsRegisterModalVisible(true);};var closeRegisterModal=function closeRegisterModal(){setIsRegisterModalVisible(false);};var listTags=function listTags(){axios({method:'GET',url:SERVER_URL+'tag'}).then(function(response){if(response.data.status===200){var _tagList=response.data.data;var tags=[];for(var i=0;i<_tagList.length;i++){tags.push({label:_tagList[i].tagName,value:_tagList[i].tagId});}// console.log(tags);\nsetTagList(tags);}});};var showTagModal=function showTagModal(){listTags();setIsTagModalVisible(true);};var closeTagModal=function closeTagModal(){setIsTagModalVisible(false);};// 提交选择的标签\nvar insertUserTags=function insertUserTags(value){console.log(value.tags);if(value.tags.length>0){axios({method:'POST',url:SERVER_URL+'user_tag',data:{tags:value.tags},headers:{Authorization:getToken()}}).then(function(response){closeTagModal();});}};var login=function login(value){axios({method:'POST',url:'http://localhost:3001/server/login',data:{username:value.username,password:value.password}}).then(function(response){if(response.data.status!==200){alert1.current.innerHTML=response.data.message;alert1.current.style.display='block';}else{if(value.remember){localStorage.setItem('token',response.data.token);}sessionStorage.setItem('token',response.data.token);PubSub.publish('login',response.data.data);closeLoginModal();}});};var register=function register(value){if(value.confirm!==value.password){alert2.current.innerHTML='密码不一致';alert2.current.style.display='block';return;}axios({method:'POST',url:'http://localhost:3001/server/register',data:{username:value.username,password:value.password,nickname:value.nickname}}).then(function(response){if(response.data.status===200){sessionStorage.setItem('token',response.data.token);PubSub.publish('login',response.data.data);closeRegisterModal();showTagModal();}else{_this.alert2.innerHTML=response.data.message;_this.alert2.style.display='block';}});};var search=function search(value){if(value.trim()!==''){props.history.push(\"/search?type=music&word=\".concat(value));}};var handleClick=function handleClick(obj){if(obj.key==='discover'){props.history.push('/discover');}else if(obj.key==='my_music'){if(props.user){props.history.push('/my_music');}else{showLoginModal();}}else if(obj.key==='artist'){props.history.push('/artist_list?artist_location=hot');}else if(obj.key==='top_list'){props.history.push('/top_list?type=total');}};return/*#__PURE__*/_jsx(Header,{children:/*#__PURE__*/_jsxs(\"div\",{style:{width:'1100px',margin:'0 auto',display:'flex'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"logo\",style:{color:'white'},children:[/*#__PURE__*/_jsx(\"span\",{className:\"fa fa-music\"}),\"\\xA0 718\\u97F3\\u4E50\"]}),/*#__PURE__*/_jsxs(Menu,{theme:\"dark\",mode:\"horizontal\",defaultSelectedKeys:\"discover\",style:{marginLeft:100},onClick:handleClick,children:[/*#__PURE__*/_jsx(Menu.Item,{children:\"\\u53D1\\u73B0\\u97F3\\u4E50\"},\"discover\"),/*#__PURE__*/_jsx(Menu.Item,{children:\"\\u6392\\u884C\\u699C\"},\"top_list\"),/*#__PURE__*/_jsx(Menu.Item,{children:\"\\u6B4C\\u624B\"},\"artist\"),/*#__PURE__*/_jsx(Menu.Item,{children:\"\\u6211\\u7684\\u97F3\\u4E50\"},\"my_music\")]}),/*#__PURE__*/_jsx(Search,{placeholder:\"\\u641C\\u7D22\",style:{width:'200px',display:'block',margin:'auto 50px auto 50px'},onSearch:search}),props.user?/*#__PURE__*/_jsx(Dropdown,{overlay:userMenu,children:/*#__PURE__*/_jsx(Button,{type:\"link\",style:{color:'yellow',display:'block',margin:'auto 0 auto auto'},children:props.user.username})}):/*#__PURE__*/_jsx(Button,{type:\"primary\",style:{display:'block',margin:'auto 0 auto auto'},onClick:showLoginModal,children:\"\\u767B\\u5F55\"}),/*#__PURE__*/_jsx(Modal,{title:\"\\u767B\\u5F55\",visible:isLoginModalVisible,onCancel:closeLoginModal,footer:[/*#__PURE__*/_jsx(Button,{type:\"primary\",style:{float:'left'},onClick:showRegisterModal,children:\"\\u6CE8\\u518C\"},\"register\"),/*#__PURE__*/_jsx(Button,{onClick:closeLoginModal,children:\"\\u53D6\\u6D88\"},\"cancel\")],children:/*#__PURE__*/_jsxs(Form,{onFinish:login,children:[/*#__PURE__*/_jsx(\"div\",{ref:alert1,style:{backgroundColor:'#ffccc7',width:'100%',padding:'8px 15px',marginBottom:'10px',display:'none'}}),/*#__PURE__*/_jsx(Form.Item,{name:\"username\",rules:[{required:true,message:'用户名不能为空!'}],children:/*#__PURE__*/_jsx(Input,{prefix:/*#__PURE__*/_jsx(UserOutlined,{}),placeholder:\"\\u8BF7\\u8F93\\u5165\\u7528\\u6237\\u540D\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"password\",rules:[{required:true,message:'密码不能为空!'}],children:/*#__PURE__*/_jsx(Input.Password,{prefix:/*#__PURE__*/_jsx(LockOutlined,{}),placeholder:\"\\u8BF7\\u8F93\\u5165\\u5BC6\\u7801\"})}),/*#__PURE__*/_jsx(Form.Item,{children:/*#__PURE__*/_jsx(Form.Item,{name:\"remember\",valuePropName:\"checked\",noStyle:true,children:/*#__PURE__*/_jsx(Checkbox,{children:\"\\u8BB0\\u4F4F\\u6211\"})})}),/*#__PURE__*/_jsx(Form.Item,{children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",style:{width:'100%'},children:\"\\u767B\\u5F55\"})})]})}),/*#__PURE__*/_jsx(Modal,{title:\"\\u6CE8\\u518C\",visible:isRegisterModalVisible,destroyOnClose:true,onCancel:closeRegisterModal,footer:[/*#__PURE__*/_jsx(Button,{type:\"primary\",style:{float:'left'},onClick:showLoginModal,children:\"\\u767B\\u5F55\"},\"register\"),/*#__PURE__*/_jsx(Button,{onClick:closeRegisterModal,children:\"\\u53D6\\u6D88\"},\"cancel\")],children:/*#__PURE__*/_jsxs(Form,{onFinish:register,children:[/*#__PURE__*/_jsx(\"div\",{ref:alert2,style:{backgroundColor:'#ffccc7',width:'100%',padding:'8px 15px',marginBottom:'10px',display:'none'}}),/*#__PURE__*/_jsx(Form.Item,{name:\"username\",label:\"\\u7528\\u6237\\u540D\",rules:[{required:true,message:'用户名不能为空!'}],children:/*#__PURE__*/_jsx(Input,{placeholder:\"\\u8BF7\\u8F93\\u5165\\u7528\\u6237\\u540D\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"password\",label:\"\\u5BC6\\u7801\",rules:[{required:true,message:'密码不能为空!'}],children:/*#__PURE__*/_jsx(Input.Password,{placeholder:\"\\u8BF7\\u8F93\\u5165\\u5BC6\\u7801\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"confirm\",label:\"\\u786E\\u8BA4\\u5BC6\\u7801\",dependencies:['password'],rules:[{required:true,message:'密码不能为空!'},function(_ref){var getFieldValue=_ref.getFieldValue;return{validator:function validator(_,value){if(!value||getFieldValue('password')===value){return Promise.resolve();}return Promise.reject(new Error('密码不一致!'));}};}],children:/*#__PURE__*/_jsx(Input.Password,{placeholder:\"\\u8BF7\\u518D\\u6B21\\u8F93\\u5165\\u5BC6\\u7801\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"nickname\",label:\"\\u6635\\u79F0\",rules:[{required:true,message:'昵称不能为空!'}],children:/*#__PURE__*/_jsx(Input,{placeholder:\"\\u8BF7\\u8F93\\u5165\\u6635\\u79F0\"})}),/*#__PURE__*/_jsx(Form.Item,{children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",style:{width:'100%'},children:\"\\u6CE8\\u518C\"})})]})}),/*#__PURE__*/_jsx(Modal,{title:\"\\u559C\\u6B22\\u7684\\u7C7B\\u578B\",visible:isTagModalVisible,onCancel:closeTagModal,footer:null,children:/*#__PURE__*/_jsxs(Form,{onFinish:insertUserTags,children:[/*#__PURE__*/_jsx(Form.Item,{name:\"tags\",children:/*#__PURE__*/_jsx(Checkbox.Group,{options:tagList})}),/*#__PURE__*/_jsx(Form.Item,{children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",style:{float:'right'},children:\"\\u786E\\u5B9A\"})})]})})]})});}export default withRouter(MyHeader);","map":{"version":3,"sources":["D:/Programming/Project/Music_Recommend_System/client/src/components/MyHeader/index.jsx"],"names":["React","useEffect","useRef","useState","Button","Menu","Input","Modal","Form","Checkbox","Dropdown","Layout","withRouter","LockOutlined","UserOutlined","LogoutOutlined","axios","PubSub","SERVER_URL","getToken","Header","Search","MyHeader","props","isLoginModalVisible","setIsLoginModalVisible","isRegisterModalVisible","setIsRegisterModalVisible","isTagModalVisible","setIsTagModalVisible","tagList","setTagList","subscribe","showLoginModal","unsubscribe","alert1","alert2","handleClickUserMenu","obj","key","publish","userMenu","closeRegisterModal","closeLoginModal","showRegisterModal","listTags","method","url","then","response","data","status","tags","i","length","push","label","tagName","value","tagId","showTagModal","closeTagModal","insertUserTags","console","log","headers","Authorization","login","username","password","current","innerHTML","message","style","display","remember","localStorage","setItem","token","sessionStorage","register","confirm","nickname","search","trim","history","handleClick","user","width","margin","color","marginLeft","float","backgroundColor","padding","marginBottom","required","getFieldValue","validator","_","Promise","resolve","reject","Error"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react'\r\nimport { Button, Menu, Input, Modal, Form, Checkbox, Dropdown, Layout } from 'antd';\r\nimport {withRouter} from 'react-router-dom';\r\nimport 'antd/dist/antd.min.css';\r\nimport { LockOutlined, UserOutlined, LogoutOutlined } from '@ant-design/icons';\r\nimport axios from 'axios';\r\nimport PubSub from 'pubsub-js';\r\nimport {SERVER_URL} from \"../../utils/constant\";\r\nimport {getToken} from \"../../utils/auth\";\r\n\r\nconst { Header } = Layout;\r\nconst {Search} = Input;\r\n\r\nfunction MyHeader(props) {\r\n    const [isLoginModalVisible, setIsLoginModalVisible] = useState(false);\r\n    const [isRegisterModalVisible, setIsRegisterModalVisible] = useState(false);\r\n    const [isTagModalVisible, setIsTagModalVisible] = useState(false);\r\n    const [tagList, setTagList] = useState([]);\r\n\r\n    useEffect(() => {\r\n        PubSub.subscribe('showLoginModal', showLoginModal);\r\n        return () => {\r\n            PubSub.unsubscribe('showLoginModal');\r\n        }  // eslint-disable-next-line\r\n    }, []);\r\n    \r\n    const alert1 = useRef(null);\r\n    const alert2 = useRef(null);\r\n\r\n    const handleClickUserMenu = (obj) => {\r\n        if (obj.key === 'logout') {\r\n            PubSub.publish('logout');\r\n        }\r\n    }\r\n\r\n    const userMenu = () => {\r\n        return (\r\n            <Menu onClick={handleClickUserMenu}>\r\n                <Menu.Item key=\"home\" icon={<UserOutlined />}>\r\n                    我的主页\r\n                </Menu.Item>\r\n                <Menu.Item key=\"logout\" icon={<LogoutOutlined />}>\r\n                    退出\r\n                </Menu.Item>\r\n            </Menu>\r\n        );\r\n    }\r\n\r\n    const showLoginModal = () => {\r\n        closeRegisterModal();\r\n        setIsLoginModalVisible(true);\r\n    }\r\n\r\n    const closeLoginModal = () => {\r\n        setIsLoginModalVisible(false);\r\n    }\r\n\r\n    const showRegisterModal = () => {\r\n        closeLoginModal();\r\n        setIsRegisterModalVisible(true);\r\n    }\r\n\r\n    const closeRegisterModal = () => {\r\n        setIsRegisterModalVisible(false);\r\n    }\r\n\r\n    const listTags = () => {\r\n        axios({\r\n            method: 'GET',\r\n            url: SERVER_URL + 'tag'\r\n        }).then((response) => {\r\n            if (response.data.status === 200) {\r\n                let tagList = response.data.data;\r\n                let tags = [];\r\n                for (let i = 0; i < tagList.length; i++) {\r\n                    tags.push({\r\n                        label: tagList[i].tagName,\r\n                        value: tagList[i].tagId\r\n                    });\r\n                }\r\n                // console.log(tags);\r\n                setTagList(tags);\r\n            }\r\n        });\r\n    }\r\n\r\n    const showTagModal = () => {\r\n        listTags();\r\n        setIsTagModalVisible(true);\r\n    }\r\n\r\n    const closeTagModal = () => {\r\n        setIsTagModalVisible(false);\r\n    }\r\n\r\n    // 提交选择的标签\r\n    const insertUserTags = (value) => {\r\n        console.log(value.tags);\r\n        if (value.tags.length > 0) {\r\n            axios({\r\n                method: 'POST',\r\n                url: SERVER_URL + 'user_tag',\r\n                data: {\r\n                    tags: value.tags\r\n                },\r\n                headers: {\r\n                    Authorization: getToken()\r\n                }\r\n            }).then((response) => {\r\n                closeTagModal();\r\n            })\r\n        }\r\n    }\r\n\r\n    const login = (value) => {\r\n        axios({\r\n            method: 'POST',\r\n            url: 'http://localhost:3001/server/login',\r\n            data: {\r\n                username: value.username,\r\n                password: value.password\r\n            }\r\n        }).then((response) => {\r\n            if (response.data.status !== 200) {\r\n                alert1.current.innerHTML = response.data.message;\r\n                alert1.current.style.display = 'block';\r\n            } else {\r\n                if (value.remember) {\r\n                    localStorage.setItem('token', response.data.token);\r\n                } \r\n                sessionStorage.setItem('token', response.data.token);\r\n                PubSub.publish('login', response.data.data);\r\n                closeLoginModal();\r\n            }\r\n        })\r\n    }\r\n\r\n    const register = (value) => {\r\n        if (value.confirm !== value.password) {\r\n            alert2.current.innerHTML = '密码不一致';\r\n            alert2.current.style.display = 'block';\r\n            return;\r\n        }\r\n        axios({\r\n            method: 'POST',\r\n            url: 'http://localhost:3001/server/register',\r\n            data: {\r\n                username: value.username,\r\n                password: value.password,\r\n                nickname: value.nickname\r\n            }\r\n        }).then((response) => {\r\n            if (response.data.status === 200) {\r\n                sessionStorage.setItem('token', response.data.token);\r\n                PubSub.publish('login', response.data.data);\r\n                closeRegisterModal();\r\n                showTagModal();\r\n            } else {\r\n                this.alert2.innerHTML = response.data.message;\r\n                this.alert2.style.display = 'block';\r\n            }\r\n        });\r\n    }\r\n\r\n    const search = (value) => {\r\n        if (value.trim() !== '') {\r\n            props.history.push(`/search?type=music&word=${value}`);\r\n        }\r\n    }\r\n\r\n    const handleClick = (obj) => {\r\n        if (obj.key === 'discover') {\r\n            props.history.push('/discover');\r\n        } else if (obj.key === 'my_music') {\r\n            if (props.user) {\r\n                props.history.push('/my_music');\r\n            } else {\r\n                showLoginModal();\r\n            }\r\n        } else if (obj.key === 'artist') {\r\n            props.history.push('/artist_list?artist_location=hot');\r\n        } else if (obj.key === 'top_list') {\r\n            props.history.push('/top_list?type=total');\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Header>\r\n            <div style={{width: '1100px', margin: '0 auto', display: 'flex'}}>\r\n                <div className=\"logo\" style={{color: 'white'}}>\r\n                    <span className=\"fa fa-music\"></span>&nbsp;\r\n                    718音乐\r\n                </div>\r\n                <Menu theme=\"dark\" mode=\"horizontal\" defaultSelectedKeys=\"discover\" style={{marginLeft: 100}} onClick={handleClick}>\r\n                    <Menu.Item key=\"discover\">发现音乐</Menu.Item>\r\n                    <Menu.Item key=\"top_list\">排行榜</Menu.Item>\r\n                    <Menu.Item key=\"artist\">歌手</Menu.Item>\r\n                    <Menu.Item key=\"my_music\">我的音乐</Menu.Item>\r\n                </Menu>\r\n                <Search placeholder=\"搜索\" style={{ width: '200px', display: 'block', margin: 'auto 50px auto 50px'}} onSearch={search} />\r\n                {props.user ? <Dropdown overlay={userMenu}><Button type=\"link\" style={{color: 'yellow', display: 'block', margin: 'auto 0 auto auto'}}>{props.user.username}</Button></Dropdown>\r\n                : <Button type=\"primary\" style={{display: 'block', margin: 'auto 0 auto auto'}} onClick={showLoginModal}>登录</Button>}\r\n                <Modal title=\"登录\" visible={isLoginModalVisible} onCancel={closeLoginModal} footer={[\r\n                    <Button key=\"register\" type=\"primary\" style={{float: 'left'}} onClick={showRegisterModal}>注册</Button>,\r\n                    <Button key=\"cancel\" onClick={closeLoginModal}>取消</Button>,\r\n                ]}>\r\n                    <Form onFinish={login}>\r\n                        <div ref={alert1} style={{backgroundColor: '#ffccc7', width: '100%', padding: '8px 15px', marginBottom: '10px', display: 'none'}}></div>\r\n                        <Form.Item name=\"username\" rules={[{ required: true, message: '用户名不能为空!' }]}>\r\n                            <Input prefix={<UserOutlined />} placeholder=\"请输入用户名\" />\r\n                        </Form.Item>\r\n                        <Form.Item name=\"password\" rules={[{required: true, message: '密码不能为空!'}]}>\r\n                            <Input.Password prefix={<LockOutlined />} placeholder=\"请输入密码\" />\r\n                        </Form.Item>\r\n                        <Form.Item>\r\n                            <Form.Item name=\"remember\" valuePropName=\"checked\" noStyle>\r\n                                <Checkbox>记住我</Checkbox>\r\n                            </Form.Item>\r\n                            {/* <a className=\"login-form-forgot\" href=\"\" style={{float: 'right'}}>忘记密码</a> */}\r\n                        </Form.Item>\r\n                        <Form.Item>\r\n                            <Button type=\"primary\" htmlType=\"submit\" style={{width: '100%'}}>登录</Button>\r\n                        </Form.Item>\r\n                    </Form>\r\n                </Modal>\r\n                <Modal title=\"注册\" visible={isRegisterModalVisible} destroyOnClose onCancel={closeRegisterModal} footer={[\r\n                    <Button key=\"register\" type=\"primary\" style={{float: 'left'}} onClick={showLoginModal}>登录</Button>,\r\n                    <Button key=\"cancel\" onClick={closeRegisterModal}>取消</Button>]}>\r\n                    <Form onFinish={register}>\r\n                        <div ref={alert2} style={{backgroundColor: '#ffccc7', width: '100%', padding: '8px 15px', marginBottom: '10px', display: 'none'}}></div>\r\n                        <Form.Item name=\"username\" label=\"用户名\" rules={[{ required: true, message: '用户名不能为空!'}]}>\r\n                            <Input placeholder=\"请输入用户名\" />\r\n                        </Form.Item>\r\n                        <Form.Item name=\"password\" label=\"密码\" rules={[{required: true, message: '密码不能为空!'}]}>\r\n                            <Input.Password placeholder=\"请输入密码\" />\r\n                        </Form.Item>\r\n                        <Form.Item name=\"confirm\" label=\"确认密码\" dependencies={['password']} rules={[\r\n                            {required: true, message: '密码不能为空!'},\r\n                            ({ getFieldValue }) => ({\r\n                                validator(_, value) {\r\n                                    if (!value || getFieldValue('password') === value) {\r\n                                        return Promise.resolve();\r\n                                    }\r\n                                    return Promise.reject(new Error('密码不一致!'));\r\n                                },\r\n                            })\r\n                        ]}>\r\n                            <Input.Password placeholder=\"请再次输入密码\" />\r\n                        </Form.Item>\r\n                        <Form.Item name=\"nickname\" label=\"昵称\" rules={[{required: true, message: '昵称不能为空!'}]}>\r\n                            <Input placeholder=\"请输入昵称\" />\r\n                        </Form.Item>\r\n                        <Form.Item>\r\n                            <Button type=\"primary\" htmlType=\"submit\" style={{width: '100%'}}>注册</Button>\r\n                        </Form.Item>\r\n                    </Form>\r\n                </Modal>\r\n                <Modal title=\"喜欢的类型\" visible={isTagModalVisible} onCancel={closeTagModal} footer={null}>\r\n                    <Form onFinish={insertUserTags}>\r\n                        <Form.Item name=\"tags\">\r\n                            <Checkbox.Group options={tagList} />\r\n                        </Form.Item>\r\n                        <Form.Item>\r\n                            <Button type=\"primary\" htmlType=\"submit\" style={{float: 'right'}}>确定</Button>\r\n                        </Form.Item>\r\n                    </Form>\r\n                </Modal>\r\n            </div>\r\n        </Header>\r\n    );\r\n}\r\n\r\nexport default withRouter(MyHeader);"]},"metadata":{},"sourceType":"module"}