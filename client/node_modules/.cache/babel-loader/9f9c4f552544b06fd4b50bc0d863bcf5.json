{"ast":null,"code":"var _jsxFileName = \"D:\\\\Programming\\\\Project\\\\Music_Recommend_System\\\\client\\\\src\\\\components\\\\MyHeader\\\\index.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport { Button, Menu, Input, Modal, Form, Checkbox, Dropdown, Layout } from 'antd';\nimport { withRouter } from 'react-router-dom';\nimport 'antd/dist/antd.min.css';\nimport { LockOutlined, UserOutlined, LogoutOutlined } from '@ant-design/icons';\nimport axios from 'axios';\nimport PubSub from 'pubsub-js';\nimport { SERVER_URL } from \"../../utils/constant\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Header\n} = Layout;\nconst {\n  Search\n} = Input;\n\nfunction MyHeader(props) {\n  _s();\n\n  const [isLoginModalVisible, setIsLoginModalVisible] = useState(false);\n  const [isRegisterModalVisible, setIsRegisterModalVisible] = useState(false);\n  const [isTagModalVisible, setIsTagModalVisible] = useState(false);\n  const [tagList, setTagList] = useState([]);\n  useEffect(() => {\n    PubSub.subscribe('showLoginModal', showLoginModal);\n    return () => {\n      PubSub.unsubscribe('showLoginModal');\n    }; // eslint-disable-next-line\n  }, []);\n  const alert1 = useRef(null);\n  const alert2 = useRef(null);\n\n  const handleClickUserMenu = obj => {\n    if (obj.key === 'logout') {\n      PubSub.publish('logout');\n    }\n  };\n\n  const userMenu = () => {\n    return /*#__PURE__*/_jsxDEV(Menu, {\n      onClick: handleClickUserMenu,\n      children: [/*#__PURE__*/_jsxDEV(Menu.Item, {\n        icon: /*#__PURE__*/_jsxDEV(UserOutlined, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 38,\n          columnNumber: 45\n        }, this),\n        children: \"\\u6211\\u7684\\u4E3B\\u9875\"\n      }, \"home\", false, {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Menu.Item, {\n        icon: /*#__PURE__*/_jsxDEV(LogoutOutlined, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 41,\n          columnNumber: 47\n        }, this),\n        children: \"\\u9000\\u51FA\"\n      }, \"logout\", false, {\n        fileName: _jsxFileName,\n        lineNumber: 41,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 13\n    }, this);\n  };\n\n  const showLoginModal = () => {\n    closeRegisterModal();\n    setIsLoginModalVisible(true);\n  };\n\n  const closeLoginModal = () => {\n    setIsLoginModalVisible(false);\n  };\n\n  const showRegisterModal = () => {\n    closeLoginModal();\n    setIsRegisterModalVisible(true);\n  };\n\n  const closeRegisterModal = () => {\n    setIsRegisterModalVisible(false);\n  };\n\n  const getTagList = () => {\n    axios({\n      method: 'GET',\n      url: SERVER_URL + 'tag'\n    }).then(response => {\n      if (response.data.status === 200) {\n        let tagList = response.data.data;\n        let tags = [];\n\n        for (let i = 0; i < tagList.length; i++) {\n          tags.push({\n            label: tagList[i].tagName,\n            value: tagList[i].tagId\n          });\n        } // console.log(tags);\n\n\n        setTagList(tags);\n      }\n    });\n  };\n\n  const showTagModal = () => {\n    getTagList();\n    setIsTagModalVisible(true);\n  };\n\n  const closeTagModal = () => {\n    setIsTagModalVisible(false);\n  }; // 提交选择的标签\n\n\n  const selectTag = value => {\n    console.log(value.tags);\n\n    if (value.tags.length > 0) {\n      axios({\n        method: 'POST',\n        url: SERVER_URL + '',\n        data: {\n          tags: value.tags\n        },\n        headers: {\n          Authorization: getToken()\n        }\n      });\n    }\n  };\n\n  const login = value => {\n    axios({\n      method: 'POST',\n      url: 'http://localhost:3001/server/login',\n      data: {\n        username: value.username,\n        password: value.password\n      }\n    }).then(response => {\n      if (response.data.status !== 200) {\n        alert1.current.innerHTML = response.data.message;\n        alert1.current.style.display = 'block';\n      } else {\n        if (value.remember) {\n          localStorage.setItem('token', response.data.token);\n        }\n\n        sessionStorage.setItem('token', response.data.token);\n        PubSub.publish('login', response.data.data);\n        closeLoginModal();\n      }\n    });\n  };\n\n  const register = value => {\n    if (value.confirm !== value.password) {\n      alert2.current.innerHTML = '密码不一致';\n      alert2.current.style.display = 'block';\n      return;\n    }\n\n    axios({\n      method: 'POST',\n      url: 'http://localhost:3001/server/register',\n      data: {\n        username: value.username,\n        password: value.password,\n        nickname: value.nickname\n      }\n    }).then(response => {\n      if (response.data.status === 200) {\n        sessionStorage.setItem('token', response.data.token);\n        PubSub.publish('login', response.data.data);\n        closeRegisterModal();\n        showTagModal();\n      } else {\n        this.alert2.innerHTML = response.data.message;\n        this.alert2.style.display = 'block';\n      }\n    });\n  };\n\n  const search = value => {\n    if (value.trim() !== '') {\n      props.history.push(`/search?type=music&word=${value}`);\n    }\n  };\n\n  const handleClick = obj => {\n    if (obj.key === 'discover') {\n      props.history.push('/discover');\n    } else if (obj.key === 'my_music') {\n      if (props.user) {\n        props.history.push('/my_music');\n      } else {\n        showLoginModal();\n      }\n    } else if (obj.key === 'artist') {\n      props.history.push('/artist_list?artist_location=hot');\n    } else if (obj.key === 'top_list') {\n      props.history.push('/top_list?type=total');\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(Header, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        width: '1100px',\n        margin: '0 auto',\n        display: 'flex'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"logo\",\n        style: {\n          color: 'white'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"fa fa-music\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 21\n        }, this), \"\\xA0 718\\u97F3\\u4E50\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Menu, {\n        theme: \"dark\",\n        mode: \"horizontal\",\n        defaultSelectedKeys: \"discover\",\n        style: {\n          marginLeft: 100\n        },\n        onClick: handleClick,\n        children: [/*#__PURE__*/_jsxDEV(Menu.Item, {\n          children: \"\\u53D1\\u73B0\\u97F3\\u4E50\"\n        }, \"discover\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Menu.Item, {\n          children: \"\\u6392\\u884C\\u699C\"\n        }, \"top_list\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Menu.Item, {\n          children: \"\\u6B4C\\u624B\"\n        }, \"artist\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Menu.Item, {\n          children: \"\\u6211\\u7684\\u97F3\\u4E50\"\n        }, \"my_music\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Search, {\n        placeholder: \"\\u641C\\u7D22\",\n        style: {\n          width: '200px',\n          display: 'block',\n          margin: 'auto 50px auto 50px'\n        },\n        onSearch: search\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 17\n      }, this), props.user ? /*#__PURE__*/_jsxDEV(Dropdown, {\n        overlay: userMenu,\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          type: \"link\",\n          style: {\n            color: 'yellow',\n            display: 'block',\n            margin: 'auto 0 auto auto'\n          },\n          children: props.user.username\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 60\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 31\n      }, this) : /*#__PURE__*/_jsxDEV(Button, {\n        type: \"primary\",\n        style: {\n          display: 'block',\n          margin: 'auto 0 auto auto'\n        },\n        onClick: showLoginModal,\n        children: \"\\u767B\\u5F55\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 19\n      }, this), /*#__PURE__*/_jsxDEV(Modal, {\n        title: \"\\u767B\\u5F55\",\n        visible: isLoginModalVisible,\n        onCancel: closeLoginModal,\n        footer: [/*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          style: {\n            float: 'left'\n          },\n          onClick: showRegisterModal,\n          children: \"\\u6CE8\\u518C\"\n        }, \"register\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: closeLoginModal,\n          children: \"\\u53D6\\u6D88\"\n        }, \"cancel\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 21\n        }, this)],\n        children: /*#__PURE__*/_jsxDEV(Form, {\n          onFinish: login,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            ref: alert1,\n            style: {\n              backgroundColor: '#ffccc7',\n              width: '100%',\n              padding: '8px 15px',\n              marginBottom: '10px',\n              display: 'none'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n            name: \"username\",\n            rules: [{\n              required: true,\n              message: '用户名不能为空!'\n            }],\n            children: /*#__PURE__*/_jsxDEV(Input, {\n              prefix: /*#__PURE__*/_jsxDEV(UserOutlined, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 207,\n                columnNumber: 44\n              }, this),\n              placeholder: \"\\u8BF7\\u8F93\\u5165\\u7528\\u6237\\u540D\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 207,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 206,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n            name: \"password\",\n            rules: [{\n              required: true,\n              message: '密码不能为空!'\n            }],\n            children: /*#__PURE__*/_jsxDEV(Input.Password, {\n              prefix: /*#__PURE__*/_jsxDEV(LockOutlined, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 210,\n                columnNumber: 53\n              }, this),\n              placeholder: \"\\u8BF7\\u8F93\\u5165\\u5BC6\\u7801\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 210,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n            children: /*#__PURE__*/_jsxDEV(Form.Item, {\n              name: \"remember\",\n              valuePropName: \"checked\",\n              noStyle: true,\n              children: /*#__PURE__*/_jsxDEV(Checkbox, {\n                children: \"\\u8BB0\\u4F4F\\u6211\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 214,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 213,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 212,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              type: \"primary\",\n              htmlType: \"submit\",\n              style: {\n                width: '100%'\n              },\n              children: \"\\u767B\\u5F55\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 219,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 218,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Modal, {\n        title: \"\\u6CE8\\u518C\",\n        visible: isRegisterModalVisible,\n        destroyOnClose: true,\n        onCancel: closeRegisterModal,\n        footer: [/*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          style: {\n            float: 'left'\n          },\n          onClick: showLoginModal,\n          children: \"\\u767B\\u5F55\"\n        }, \"register\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: closeRegisterModal,\n          children: \"\\u53D6\\u6D88\"\n        }, \"cancel\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 21\n        }, this)],\n        children: /*#__PURE__*/_jsxDEV(Form, {\n          onFinish: register,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            ref: alert2,\n            style: {\n              backgroundColor: '#ffccc7',\n              width: '100%',\n              padding: '8px 15px',\n              marginBottom: '10px',\n              display: 'none'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 227,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n            name: \"username\",\n            label: \"\\u7528\\u6237\\u540D\",\n            rules: [{\n              required: true,\n              message: '用户名不能为空!'\n            }],\n            children: /*#__PURE__*/_jsxDEV(Input, {\n              placeholder: \"\\u8BF7\\u8F93\\u5165\\u7528\\u6237\\u540D\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 229,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n            name: \"password\",\n            label: \"\\u5BC6\\u7801\",\n            rules: [{\n              required: true,\n              message: '密码不能为空!'\n            }],\n            children: /*#__PURE__*/_jsxDEV(Input.Password, {\n              placeholder: \"\\u8BF7\\u8F93\\u5165\\u5BC6\\u7801\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 232,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n            name: \"confirm\",\n            label: \"\\u786E\\u8BA4\\u5BC6\\u7801\",\n            dependencies: ['password'],\n            rules: [{\n              required: true,\n              message: '密码不能为空!'\n            }, ({\n              getFieldValue\n            }) => ({\n              validator(_, value) {\n                if (!value || getFieldValue('password') === value) {\n                  return Promise.resolve();\n                }\n\n                return Promise.reject(new Error('密码不一致!'));\n              }\n\n            })],\n            children: /*#__PURE__*/_jsxDEV(Input.Password, {\n              placeholder: \"\\u8BF7\\u518D\\u6B21\\u8F93\\u5165\\u5BC6\\u7801\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 245,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 234,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n            name: \"nickname\",\n            label: \"\\u6635\\u79F0\",\n            rules: [{\n              required: true,\n              message: '昵称不能为空!'\n            }],\n            children: /*#__PURE__*/_jsxDEV(Input, {\n              placeholder: \"\\u8BF7\\u8F93\\u5165\\u6635\\u79F0\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 248,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 247,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              type: \"primary\",\n              htmlType: \"submit\",\n              style: {\n                width: '100%'\n              },\n              children: \"\\u6CE8\\u518C\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 250,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Modal, {\n        title: \"\\u559C\\u6B22\\u7684\\u7C7B\\u578B\",\n        visible: isTagModalVisible,\n        onCancel: closeTagModal,\n        footer: null,\n        children: /*#__PURE__*/_jsxDEV(Form, {\n          onFinish: selectTag,\n          children: [/*#__PURE__*/_jsxDEV(Form.Item, {\n            name: \"tags\",\n            children: /*#__PURE__*/_jsxDEV(Checkbox.Group, {\n              options: tagList\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 258,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              type: \"primary\",\n              htmlType: \"submit\",\n              style: {\n                float: 'right'\n              },\n              children: \"\\u786E\\u5B9A\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 185,\n    columnNumber: 9\n  }, this);\n}\n\n_s(MyHeader, \"gUZN8yykp9r48s48h1j/FjaEQIY=\");\n\n_c = MyHeader;\nexport default _c2 = withRouter(MyHeader);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"MyHeader\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["D:/Programming/Project/Music_Recommend_System/client/src/components/MyHeader/index.jsx"],"names":["React","useEffect","useRef","useState","Button","Menu","Input","Modal","Form","Checkbox","Dropdown","Layout","withRouter","LockOutlined","UserOutlined","LogoutOutlined","axios","PubSub","SERVER_URL","Header","Search","MyHeader","props","isLoginModalVisible","setIsLoginModalVisible","isRegisterModalVisible","setIsRegisterModalVisible","isTagModalVisible","setIsTagModalVisible","tagList","setTagList","subscribe","showLoginModal","unsubscribe","alert1","alert2","handleClickUserMenu","obj","key","publish","userMenu","closeRegisterModal","closeLoginModal","showRegisterModal","getTagList","method","url","then","response","data","status","tags","i","length","push","label","tagName","value","tagId","showTagModal","closeTagModal","selectTag","console","log","headers","Authorization","getToken","login","username","password","current","innerHTML","message","style","display","remember","localStorage","setItem","token","sessionStorage","register","confirm","nickname","search","trim","history","handleClick","user","width","margin","color","marginLeft","float","backgroundColor","padding","marginBottom","required","getFieldValue","validator","_","Promise","resolve","reject","Error"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react'\r\nimport { Button, Menu, Input, Modal, Form, Checkbox, Dropdown, Layout } from 'antd';\r\nimport {withRouter} from 'react-router-dom';\r\nimport 'antd/dist/antd.min.css';\r\nimport { LockOutlined, UserOutlined, LogoutOutlined } from '@ant-design/icons';\r\nimport axios from 'axios';\r\nimport PubSub from 'pubsub-js';\r\nimport {SERVER_URL} from \"../../utils/constant\";\r\n\r\nconst { Header } = Layout;\r\nconst {Search} = Input;\r\n\r\nfunction MyHeader(props) {\r\n    const [isLoginModalVisible, setIsLoginModalVisible] = useState(false);\r\n    const [isRegisterModalVisible, setIsRegisterModalVisible] = useState(false);\r\n    const [isTagModalVisible, setIsTagModalVisible] = useState(false);\r\n    const [tagList, setTagList] = useState([]);\r\n\r\n    useEffect(() => {\r\n        PubSub.subscribe('showLoginModal', showLoginModal);\r\n        return () => {\r\n            PubSub.unsubscribe('showLoginModal');\r\n        }  // eslint-disable-next-line\r\n    }, []);\r\n    \r\n    const alert1 = useRef(null);\r\n    const alert2 = useRef(null);\r\n\r\n    const handleClickUserMenu = (obj) => {\r\n        if (obj.key === 'logout') {\r\n            PubSub.publish('logout');\r\n        }\r\n    }\r\n\r\n    const userMenu = () => {\r\n        return (\r\n            <Menu onClick={handleClickUserMenu}>\r\n                <Menu.Item key=\"home\" icon={<UserOutlined />}>\r\n                    我的主页\r\n                </Menu.Item>\r\n                <Menu.Item key=\"logout\" icon={<LogoutOutlined />}>\r\n                    退出\r\n                </Menu.Item>\r\n            </Menu>\r\n        );\r\n    }\r\n\r\n    const showLoginModal = () => {\r\n        closeRegisterModal();\r\n        setIsLoginModalVisible(true);\r\n    }\r\n\r\n    const closeLoginModal = () => {\r\n        setIsLoginModalVisible(false);\r\n    }\r\n\r\n    const showRegisterModal = () => {\r\n        closeLoginModal();\r\n        setIsRegisterModalVisible(true);\r\n    }\r\n\r\n    const closeRegisterModal = () => {\r\n        setIsRegisterModalVisible(false);\r\n    }\r\n\r\n    const getTagList = () => {\r\n        axios({\r\n            method: 'GET',\r\n            url: SERVER_URL + 'tag'\r\n        }).then((response) => {\r\n            if (response.data.status === 200) {\r\n                let tagList = response.data.data;\r\n                let tags = [];\r\n                for (let i = 0; i < tagList.length; i++) {\r\n                    tags.push({\r\n                        label: tagList[i].tagName,\r\n                        value: tagList[i].tagId\r\n                    });\r\n                }\r\n                // console.log(tags);\r\n                setTagList(tags);\r\n            }\r\n        });\r\n    }\r\n\r\n    const showTagModal = () => {\r\n        getTagList();\r\n        setIsTagModalVisible(true);\r\n    }\r\n\r\n    const closeTagModal = () => {\r\n        setIsTagModalVisible(false);\r\n    }\r\n\r\n    // 提交选择的标签\r\n    const selectTag = (value) => {\r\n        console.log(value.tags);\r\n        if (value.tags.length > 0) {\r\n            axios({\r\n                method: 'POST',\r\n                url: SERVER_URL + '',\r\n                data: {\r\n                    tags: value.tags\r\n                },\r\n                headers: {\r\n                    Authorization: getToken()\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    const login = (value) => {\r\n        axios({\r\n            method: 'POST',\r\n            url: 'http://localhost:3001/server/login',\r\n            data: {\r\n                username: value.username,\r\n                password: value.password\r\n            }\r\n        }).then((response) => {\r\n            if (response.data.status !== 200) {\r\n                alert1.current.innerHTML = response.data.message;\r\n                alert1.current.style.display = 'block';\r\n            } else {\r\n                if (value.remember) {\r\n                    localStorage.setItem('token', response.data.token);\r\n                } \r\n                sessionStorage.setItem('token', response.data.token);\r\n                PubSub.publish('login', response.data.data);\r\n                closeLoginModal();\r\n            }\r\n        })\r\n    }\r\n\r\n    const register = (value) => {\r\n        if (value.confirm !== value.password) {\r\n            alert2.current.innerHTML = '密码不一致';\r\n            alert2.current.style.display = 'block';\r\n            return;\r\n        }\r\n        axios({\r\n            method: 'POST',\r\n            url: 'http://localhost:3001/server/register',\r\n            data: {\r\n                username: value.username,\r\n                password: value.password,\r\n                nickname: value.nickname\r\n            }\r\n        }).then((response) => {\r\n            if (response.data.status === 200) {\r\n                sessionStorage.setItem('token', response.data.token);\r\n                PubSub.publish('login', response.data.data);\r\n                closeRegisterModal();\r\n                showTagModal();\r\n            } else {\r\n                this.alert2.innerHTML = response.data.message;\r\n                this.alert2.style.display = 'block';\r\n            }\r\n        });\r\n    }\r\n\r\n    const search = (value) => {\r\n        if (value.trim() !== '') {\r\n            props.history.push(`/search?type=music&word=${value}`);\r\n        }\r\n    }\r\n\r\n    const handleClick = (obj) => {\r\n        if (obj.key === 'discover') {\r\n            props.history.push('/discover');\r\n        } else if (obj.key === 'my_music') {\r\n            if (props.user) {\r\n                props.history.push('/my_music');\r\n            } else {\r\n                showLoginModal();\r\n            }\r\n        } else if (obj.key === 'artist') {\r\n            props.history.push('/artist_list?artist_location=hot');\r\n        } else if (obj.key === 'top_list') {\r\n            props.history.push('/top_list?type=total');\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Header>\r\n            <div style={{width: '1100px', margin: '0 auto', display: 'flex'}}>\r\n                <div className=\"logo\" style={{color: 'white'}}>\r\n                    <span className=\"fa fa-music\"></span>&nbsp;\r\n                    718音乐\r\n                </div>\r\n                <Menu theme=\"dark\" mode=\"horizontal\" defaultSelectedKeys=\"discover\" style={{marginLeft: 100}} onClick={handleClick}>\r\n                    <Menu.Item key=\"discover\">发现音乐</Menu.Item>\r\n                    <Menu.Item key=\"top_list\">排行榜</Menu.Item>\r\n                    <Menu.Item key=\"artist\">歌手</Menu.Item>\r\n                    <Menu.Item key=\"my_music\">我的音乐</Menu.Item>\r\n                </Menu>\r\n                <Search placeholder=\"搜索\" style={{ width: '200px', display: 'block', margin: 'auto 50px auto 50px'}} onSearch={search} />\r\n                {props.user ? <Dropdown overlay={userMenu}><Button type=\"link\" style={{color: 'yellow', display: 'block', margin: 'auto 0 auto auto'}}>{props.user.username}</Button></Dropdown>\r\n                : <Button type=\"primary\" style={{display: 'block', margin: 'auto 0 auto auto'}} onClick={showLoginModal}>登录</Button>}\r\n                <Modal title=\"登录\" visible={isLoginModalVisible} onCancel={closeLoginModal} footer={[\r\n                    <Button key=\"register\" type=\"primary\" style={{float: 'left'}} onClick={showRegisterModal}>注册</Button>,\r\n                    <Button key=\"cancel\" onClick={closeLoginModal}>取消</Button>,\r\n                ]}>\r\n                    <Form onFinish={login}>\r\n                        <div ref={alert1} style={{backgroundColor: '#ffccc7', width: '100%', padding: '8px 15px', marginBottom: '10px', display: 'none'}}></div>\r\n                        <Form.Item name=\"username\" rules={[{ required: true, message: '用户名不能为空!' }]}>\r\n                            <Input prefix={<UserOutlined />} placeholder=\"请输入用户名\" />\r\n                        </Form.Item>\r\n                        <Form.Item name=\"password\" rules={[{required: true, message: '密码不能为空!'}]}>\r\n                            <Input.Password prefix={<LockOutlined />} placeholder=\"请输入密码\" />\r\n                        </Form.Item>\r\n                        <Form.Item>\r\n                            <Form.Item name=\"remember\" valuePropName=\"checked\" noStyle>\r\n                                <Checkbox>记住我</Checkbox>\r\n                            </Form.Item>\r\n                            {/* <a className=\"login-form-forgot\" href=\"\" style={{float: 'right'}}>忘记密码</a> */}\r\n                        </Form.Item>\r\n                        <Form.Item>\r\n                            <Button type=\"primary\" htmlType=\"submit\" style={{width: '100%'}}>登录</Button>\r\n                        </Form.Item>\r\n                    </Form>\r\n                </Modal>\r\n                <Modal title=\"注册\" visible={isRegisterModalVisible} destroyOnClose onCancel={closeRegisterModal} footer={[\r\n                    <Button key=\"register\" type=\"primary\" style={{float: 'left'}} onClick={showLoginModal}>登录</Button>,\r\n                    <Button key=\"cancel\" onClick={closeRegisterModal}>取消</Button>]}>\r\n                    <Form onFinish={register}>\r\n                        <div ref={alert2} style={{backgroundColor: '#ffccc7', width: '100%', padding: '8px 15px', marginBottom: '10px', display: 'none'}}></div>\r\n                        <Form.Item name=\"username\" label=\"用户名\" rules={[{ required: true, message: '用户名不能为空!'}]}>\r\n                            <Input placeholder=\"请输入用户名\" />\r\n                        </Form.Item>\r\n                        <Form.Item name=\"password\" label=\"密码\" rules={[{required: true, message: '密码不能为空!'}]}>\r\n                            <Input.Password placeholder=\"请输入密码\" />\r\n                        </Form.Item>\r\n                        <Form.Item name=\"confirm\" label=\"确认密码\" dependencies={['password']} rules={[\r\n                            {required: true, message: '密码不能为空!'},\r\n                            ({ getFieldValue }) => ({\r\n                                validator(_, value) {\r\n                                    if (!value || getFieldValue('password') === value) {\r\n                                        return Promise.resolve();\r\n                                    }\r\n                                    return Promise.reject(new Error('密码不一致!'));\r\n                                },\r\n                            })\r\n                        ]}>\r\n                            <Input.Password placeholder=\"请再次输入密码\" />\r\n                        </Form.Item>\r\n                        <Form.Item name=\"nickname\" label=\"昵称\" rules={[{required: true, message: '昵称不能为空!'}]}>\r\n                            <Input placeholder=\"请输入昵称\" />\r\n                        </Form.Item>\r\n                        <Form.Item>\r\n                            <Button type=\"primary\" htmlType=\"submit\" style={{width: '100%'}}>注册</Button>\r\n                        </Form.Item>\r\n                    </Form>\r\n                </Modal>\r\n                <Modal title=\"喜欢的类型\" visible={isTagModalVisible} onCancel={closeTagModal} footer={null}>\r\n                    <Form onFinish={selectTag}>\r\n                        <Form.Item name=\"tags\">\r\n                            <Checkbox.Group options={tagList} />\r\n                        </Form.Item>\r\n                        <Form.Item>\r\n                            <Button type=\"primary\" htmlType=\"submit\" style={{float: 'right'}}>确定</Button>\r\n                        </Form.Item>\r\n                    </Form>\r\n                </Modal>\r\n            </div>\r\n        </Header>\r\n    );\r\n}\r\n\r\nexport default withRouter(MyHeader);"]},"metadata":{},"sourceType":"module"}