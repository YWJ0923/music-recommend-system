{"ast":null,"code":"var _jsxFileName = \"D:\\\\Programming\\\\Project\\\\MusicRecommendSystem\\\\front\\\\src\\\\components\\\\PlayBar\\\\index.jsx\";\nimport React, { Component } from 'react';\nimport { StepBackwardOutlined, StepForwardOutlined, CaretRightOutlined, PauseOutlined } from '@ant-design/icons';\nimport { Button, Dropdown, Menu } from 'antd';\nimport PubSub from 'pubsub-js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default class PlayBar extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      // 播放列表\n      playList: [],\n      // 当前播放序号\n      index: 0,\n      paused: true,\n      currentTime: 0,\n      duration: 0\n    };\n\n    this.playMusic = (msg, data) => {\n      const playList = this.state.playList.filter(music => {\n        return music.musicId !== data.musicId;\n      });\n      const newPlayList = [...playList, data];\n      this.setState({\n        playList: newPlayList,\n        index: newPlayList.length - 1,\n        paused: false\n      });\n    };\n\n    this.playBackward = () => {\n      const newIndex = (this.state.index - 1 + this.state.playList.length) % this.state.playList.length;\n      this.setState({\n        index: newIndex,\n        paused: false\n      });\n      this.audio1.play();\n    };\n\n    this.playOrPause = () => {\n      this.state.paused ? this.audio1.play() : this.audio1.pause();\n      this.setState(state => {\n        return {\n          paused: !state.paused\n        };\n      });\n    };\n\n    this.playForward = () => {\n      const newIndex = (this.state.index + 1) % this.state.playList.length;\n      this.setState({\n        index: newIndex,\n        paused: false\n      });\n      this.audio1.play();\n    };\n\n    this.canPlay = () => {\n      this.setState({\n        duration: this.audio1.duration,\n        paused: false\n      });\n      this.audio1.play();\n    };\n\n    this.updatePlayTime = () => {\n      this.setState({\n        currentTime: this.audio1.currentTime\n      });\n\n      if (this.audio1.currentTime === this.audio1.duration) {\n        this.playForward();\n      }\n    };\n\n    this.changePlayTime = event => {\n      const {\n        value\n      } = event.target;\n      this.audio1.currentTime = value;\n    };\n\n    this.parseTime = time => {\n      var min = Math.floor(time / 60);\n\n      if (min < 10) {\n        min = '0' + min;\n      }\n\n      var sec = Math.floor(time % 60);\n\n      if (sec < 10) {\n        sec = '0' + sec;\n      }\n\n      return min + ':' + sec;\n    };\n\n    this.changeMusic = obj => {\n      // console.log(obj.key);\n      const music = this.state.playList.find(m => {\n        return m.musicId === obj.key;\n      });\n      this.playMusic('play', music);\n    };\n\n    this.createMenu = () => {\n      if (this.state.playList.length > 0) {\n        return /*#__PURE__*/_jsxDEV(Menu, {\n          selectedKeys: [this.state.playList[this.state.index].musicId],\n          onClick: this.changeMusic,\n          style: {\n            width: '1000px',\n            height: '300px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(Menu.Item, {\n            style: {\n              width: '650px'\n            },\n            children: [\"\\u64AD\\u653E\\u5217\\u8868 (\", this.state.playList.length, \")\"]\n          }, \"title\", true, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(Menu.Divider, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 100,\n            columnNumber: 21\n          }, this), this.state.playList.map(music => {\n            return /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(Menu.Item, {\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    display: 'flex'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      width: '500px'\n                    },\n                    children: music.musicName\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 106,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      width: '200px'\n                    },\n                    children: music.artistName\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 107,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      width: '10px'\n                    },\n                    children: this.parseTime(music.timeLength / 1000)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 108,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 105,\n                  columnNumber: 37\n                }, this)\n              }, music.musicId, false, {\n                fileName: _jsxFileName,\n                lineNumber: 104,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(Menu.Divider, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 111,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true);\n          })]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 17\n        }, this);\n      } else {\n        return /*#__PURE__*/_jsxDEV(Menu, {\n          children: [/*#__PURE__*/_jsxDEV(Menu.Item, {\n            style: {\n              width: '650px'\n            },\n            children: [\"\\u64AD\\u653E\\u5217\\u8868 (\", this.state.playList.length, \")\"]\n          }, \"title\", true, {\n            fileName: _jsxFileName,\n            lineNumber: 120,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(Menu.Divider, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 17\n        }, this);\n      }\n    };\n  }\n\n  componentDidMount() {\n    this.token = PubSub.subscribe('play', this.playMusic);\n  }\n\n  componentWillUnmount() {\n    PubSub.unsubscribe(this.token);\n  } // 收到通知，播放音乐\n\n\n  render() {\n    const {\n      currentTime,\n      duration\n    } = this.state;\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'fixed',\n          left: 0,\n          bottom: 0,\n          height: '60px',\n          backgroundColor: 'black',\n          width: '100%'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            margin: '5px auto',\n            width: '60%',\n            display: 'flex'\n          },\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            shape: \"circle\",\n            style: {\n              width: '40px',\n              height: '40px',\n              backgroundColor: 'black',\n              margin: 'auto 5px'\n            },\n            onClick: this.playBackward,\n            children: /*#__PURE__*/_jsxDEV(StepBackwardOutlined, {\n              style: {\n                color: 'white',\n                fontSize: '30px'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 135,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            shape: \"circle\",\n            style: {\n              width: '50px',\n              height: '50px',\n              backgroundColor: 'black',\n              margin: 'auto 5px'\n            },\n            onClick: this.playOrPause,\n            children: this.state.paused ? /*#__PURE__*/_jsxDEV(CaretRightOutlined, {\n              style: {\n                color: 'white',\n                fontSize: '40px'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 138,\n              columnNumber: 50\n            }, this) : /*#__PURE__*/_jsxDEV(PauseOutlined, {\n              style: {\n                color: 'white',\n                fontSize: '40px'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 138,\n              columnNumber: 118\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 137,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            shape: \"circle\",\n            style: {\n              width: '40px',\n              height: '40px',\n              backgroundColor: 'black',\n              margin: 'auto 5px'\n            },\n            onClick: this.playForward,\n            children: /*#__PURE__*/_jsxDEV(StepForwardOutlined, {\n              style: {\n                color: 'white',\n                fontSize: '30px'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 141,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 140,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n            alt: this.state.playList.length > 0 ? this.state.playList[this.state.index].musicName : '',\n            src: this.state.playList.length > 0 ? this.state.playList[this.state.index].albumImg : '/favicon.ico',\n            style: {\n              width: '50px',\n              height: '50px',\n              margin: '0 10px'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                color: 'white'\n              },\n              children: this.state.playList.length > 0 ? this.state.playList[this.state.index].musicName : '718音乐'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 145,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"barAndTime\",\n              style: {\n                marginTop: '8px',\n                width: '700px',\n                display: 'flex'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"bar\",\n                style: {\n                  width: '600px',\n                  height: '10px',\n                  marginTop: '7px',\n                  display: 'flex'\n                },\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"range\",\n                  max: duration,\n                  value: currentTime,\n                  style: {\n                    backgroundColor: 'red',\n                    height: '10px',\n                    width: '600px'\n                  },\n                  onChange: this.changePlayTime\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 150,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 149,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"time\",\n                style: {\n                  color: 'white',\n                  marginLeft: '5px'\n                },\n                children: [this.parseTime(currentTime), \"/\", this.parseTime(duration)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 153,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Dropdown, {\n            overlay: this.createMenu,\n            placement: \"topRight\",\n            arrow: true,\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              style: {\n                marginTop: '10px'\n              },\n              children: \"\\u64AD\\u653E\\u5217\\u8868\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 157,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n        src: this.state.playList.length > 0 ? this.state.playList[this.state.index].playUrl : '',\n        proload: \"auto\",\n        onCanPlay: this.canPlay,\n        onTimeUpdate: this.updatePlayTime,\n        ref: r => this.audio1 = r\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true);\n  }\n\n}","map":{"version":3,"sources":["D:/Programming/Project/MusicRecommendSystem/front/src/components/PlayBar/index.jsx"],"names":["React","Component","StepBackwardOutlined","StepForwardOutlined","CaretRightOutlined","PauseOutlined","Button","Dropdown","Menu","PubSub","PlayBar","state","playList","index","paused","currentTime","duration","playMusic","msg","data","filter","music","musicId","newPlayList","setState","length","playBackward","newIndex","audio1","play","playOrPause","pause","playForward","canPlay","updatePlayTime","changePlayTime","event","value","target","parseTime","time","min","Math","floor","sec","changeMusic","obj","find","m","key","createMenu","width","height","map","display","musicName","artistName","timeLength","componentDidMount","token","subscribe","componentWillUnmount","unsubscribe","render","position","left","bottom","backgroundColor","margin","color","fontSize","albumImg","marginTop","marginLeft","playUrl","r"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport {StepBackwardOutlined, StepForwardOutlined, CaretRightOutlined, PauseOutlined} from '@ant-design/icons';\r\nimport { Button, Dropdown, Menu } from 'antd'\r\nimport PubSub from 'pubsub-js';\r\n\r\nexport default class PlayBar extends Component {\r\n    state = {\r\n        // 播放列表\r\n        playList: [],\r\n        // 当前播放序号\r\n        index: 0,\r\n        paused: true,\r\n        currentTime: 0,\r\n        duration: 0\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.token = PubSub.subscribe('play', this.playMusic);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        PubSub.unsubscribe(this.token);\r\n    }\r\n\r\n    // 收到通知，播放音乐\r\n    playMusic = (msg, data) => {\r\n        const playList = this.state.playList.filter((music) => {\r\n            return music.musicId !== data.musicId;\r\n        });\r\n        const newPlayList = [...playList, data];\r\n        this.setState({playList: newPlayList, index: newPlayList.length - 1, paused: false});\r\n    }\r\n\r\n    playBackward = () => {\r\n        const newIndex = (this.state.index - 1 + this.state.playList.length) % this.state.playList.length;\r\n        this.setState({index: newIndex, paused: false});\r\n        this.audio1.play();\r\n    }\r\n    \r\n    playOrPause = () => {\r\n        this.state.paused ? this.audio1.play() : this.audio1.pause();\r\n        this.setState((state) => {\r\n            return {paused: !state.paused};\r\n        });\r\n    }\r\n\r\n    playForward = () => {\r\n        const newIndex = (this.state.index + 1) % this.state.playList.length;\r\n        this.setState({index: newIndex, paused: false});\r\n        this.audio1.play();\r\n    }\r\n\r\n    // 音乐加载完毕，可以播放\r\n    canPlay = () => {\r\n        this.setState({duration: this.audio1.duration, paused: false});\r\n        this.audio1.play();\r\n    }\r\n\r\n    // audio更新state时间\r\n    updatePlayTime = () => {\r\n        this.setState({currentTime: this.audio1.currentTime});\r\n        if (this.audio1.currentTime === this.audio1.duration) {\r\n            this.playForward();\r\n        }\r\n    }\r\n\r\n    // 拖动条更新时间\r\n    changePlayTime = (event) => {\r\n        const {value} = event.target;\r\n        this.audio1.currentTime = value;\r\n    }\r\n\r\n    // 解析时间成00:00格式, time以秒为单位\r\n    parseTime = (time) => {\r\n        var min = Math.floor(time / 60);\r\n        if (min < 10) {\r\n            min = '0' + min;\r\n        }\r\n        var sec = Math.floor(time % 60);\r\n        if (sec < 10) {\r\n            sec = '0' + sec;\r\n        }\r\n        return min + ':' + sec;\r\n    }\r\n\r\n    // 播放列表切换歌\r\n    changeMusic = (obj) => {\r\n        // console.log(obj.key);\r\n        const music = this.state.playList.find((m) => {\r\n            return m.musicId === obj.key;\r\n        });\r\n        this.playMusic('play', music);\r\n    }\r\n\r\n    createMenu = () => {\r\n        if (this.state.playList.length > 0) {\r\n            return (\r\n                <Menu selectedKeys={[this.state.playList[this.state.index].musicId]} onClick={this.changeMusic} style={{width: '1000px', height: '300px'}}>\r\n                    <Menu.Item key=\"title\" style={{width: '650px'}}>播放列表 ({this.state.playList.length})</Menu.Item>\r\n                    <Menu.Divider />\r\n                    {this.state.playList.map((music) => {\r\n                        return (\r\n                            <>\r\n                                <Menu.Item key={music.musicId}>\r\n                                    <div style={{display: 'flex'}}>\r\n                                        <div style={{width: '500px'}}>{music.musicName}</div>\r\n                                        <div style={{width: '200px'}}>{music.artistName}</div>\r\n                                        <div style={{width: '10px'}}>{this.parseTime(music.timeLength / 1000)}</div>\r\n                                    </div>\r\n                                </Menu.Item>\r\n                                <Menu.Divider />\r\n                            </>\r\n                        );\r\n                    })}\r\n                </Menu>\r\n            );\r\n        } else {\r\n            return (\r\n                <Menu>\r\n                    <Menu.Item key=\"title\" style={{width: '650px'}}>播放列表 ({this.state.playList.length})</Menu.Item>\r\n                    <Menu.Divider />\r\n                </Menu>\r\n            );\r\n        }\r\n        \r\n    }\r\n\r\n    render() {\r\n        const {currentTime, duration} = this.state;\r\n        return (\r\n            <>\r\n                <div style={{position: 'fixed', left: 0, bottom: 0, height: '60px', backgroundColor: 'black', width: '100%'}}>\r\n                    <div style={{margin: '5px auto', width: '60%', display: 'flex'}} >\r\n                        <Button shape='circle' style={{width: '40px', height: '40px', backgroundColor: 'black', margin: 'auto 5px'}} onClick={this.playBackward}>\r\n                            <StepBackwardOutlined style={{color: 'white', fontSize: '30px'}} />\r\n                        </Button>\r\n                        <Button shape='circle' style={{width: '50px', height: '50px', backgroundColor: 'black', margin: 'auto 5px'}} onClick={this.playOrPause}>\r\n                            {this.state.paused ? <CaretRightOutlined style={{color: 'white', fontSize: '40px'}} /> : <PauseOutlined style={{color: 'white', fontSize: '40px'}} />}\r\n                        </Button>\r\n                        <Button shape='circle' style={{width: '40px', height: '40px', backgroundColor: 'black', margin: 'auto 5px'}} onClick={this.playForward}>\r\n                            <StepForwardOutlined style={{color: 'white', fontSize: '30px'}} />\r\n                        </Button>\r\n                        <img alt={this.state.playList.length > 0 ? this.state.playList[this.state.index].musicName : ''} src={this.state.playList.length > 0 ? this.state.playList[this.state.index].albumImg : '/favicon.ico'} style={{width: '50px', height: '50px', margin: '0 10px'}} />\r\n                        <div>\r\n                            <div style={{color: 'white'}}>\r\n                                {this.state.playList.length > 0 ? this.state.playList[this.state.index].musicName : '718音乐'}\r\n                            </div>\r\n                            <div className=\"barAndTime\" style={{marginTop: '8px', width: '700px', display: 'flex'}}>\r\n                                <div className=\"bar\" style={{width: '600px', height: '10px', marginTop: '7px', display: 'flex'}}>\r\n                                    <input type=\"range\" max={duration} value={currentTime} style={{backgroundColor: 'red', height: '10px', width: '600px'}} onChange={this.changePlayTime} />\r\n                                    {/* <Button shape=\"circle\" icon={<FireOutlined />} type=\"primary\" size=\"small\" style={{marginLeft: '-12px', marginTop: '-6px'}} /> */}\r\n                                </div>\r\n                                <span className=\"time\" style={{color: 'white', marginLeft: '5px'}}>{this.parseTime(currentTime)}/{this.parseTime(duration)}</span>\r\n                            </div>\r\n                        </div>\r\n                        <Dropdown overlay={this.createMenu} placement=\"topRight\" arrow>\r\n                            <Button style={{marginTop: '10px'}}>播放列表</Button>\r\n                        </Dropdown>\r\n                    </div>\r\n                </div>\r\n                <audio src={this.state.playList.length > 0 ? this.state.playList[this.state.index].playUrl : ''} proload=\"auto\" onCanPlay={this.canPlay} onTimeUpdate={this.updatePlayTime} ref={r => this.audio1 = r}></audio>\r\n            </>\r\n        )\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}