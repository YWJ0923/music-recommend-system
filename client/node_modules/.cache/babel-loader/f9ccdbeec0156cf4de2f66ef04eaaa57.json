{"ast":null,"code":"import _slicedToArray from\"D:/Programming/Project/Music_Recommend_System/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{Suspense,useState,useEffect}from'react';import{Layout,Skeleton}from'antd';import{withRouter}from'react-router-dom';import{renderRoutes}from'react-router-config';import routes from'./router';import axios from'axios';import PlayBar from'./components/PlayBar';import MyHeader from'./components/MyHeader';import{getToken,removeToken}from'./utils/auth';import'antd/dist/antd.min.css';import'./App.css';import PubSub from\"pubsub-js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Content=Layout.Content,Footer=Layout.Footer;function App(props){var _useState=useState(undefined),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];// PubSub订阅和取消\nuseEffect(function(){PubSub.subscribe('logout',logout);PubSub.subscribe('login',login);return function(){PubSub.unsubscribe('login');PubSub.unsubscribe('logout');};// eslint-disable-next-line\n},[]);useEffect(function(){var token=getToken();if(token){axios({method:'GET',url:'http://localhost:3001/server/verify',headers:{Authorization:token}}).then(function(response){if(response.data.status===200){localStorage.setItem('token',response.data.token);setUser(response.data.data);}else if(response.data.status===401){removeToken();}else{props.history.push('/error');}});}},[]);var logout=function logout(){removeToken();setUser(undefined);};var login=function login(message,user){setUser(user);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Layout,{className:\"layout\",style:{minHeight:'100vh'},children:[/*#__PURE__*/_jsx(MyHeader,{user:user}),/*#__PURE__*/_jsx(Content,{style:{width:'1000px',margin:'0 auto'},children:/*#__PURE__*/_jsx(\"div\",{className:\"site-layout-content\",children:/*#__PURE__*/_jsx(Suspense,{fallback:/*#__PURE__*/_jsx(Skeleton,{}),children:renderRoutes(routes)})})}),/*#__PURE__*/_jsx(Footer,{style:{textAlign:'center',height:'150px'},children:\"718\\u97F3\\u4E50 \\xA92021 Created by YWJ\"})]}),/*#__PURE__*/_jsx(PlayBar,{user:user})]});}export default withRouter(App);","map":{"version":3,"sources":["D:/Programming/Project/Music_Recommend_System/client/src/App.js"],"names":["React","Suspense","useState","useEffect","Layout","Skeleton","withRouter","renderRoutes","routes","axios","PlayBar","MyHeader","getToken","removeToken","PubSub","Content","Footer","App","props","undefined","user","setUser","subscribe","logout","login","unsubscribe","token","method","url","headers","Authorization","then","response","data","status","localStorage","setItem","history","push","message","minHeight","width","margin","textAlign","height"],"mappings":"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","sourcesContent":["import React, {Suspense, useState, useEffect } from 'react';\nimport { Layout, Skeleton } from 'antd';\nimport {withRouter} from 'react-router-dom';\nimport { renderRoutes } from 'react-router-config';\nimport routes from './router';\nimport axios from 'axios';\nimport PlayBar from './components/PlayBar';\nimport MyHeader from './components/MyHeader';\nimport { getToken, removeToken } from './utils/auth';\nimport 'antd/dist/antd.min.css';\nimport './App.css';\nimport PubSub from \"pubsub-js\";\n\n\nconst { Content, Footer } = Layout;\n\nfunction App(props) {\n    const [user, setUser] = useState(undefined);\n\n    // PubSub订阅和取消\n    useEffect(() => {\n        PubSub.subscribe('logout', logout);\n        PubSub.subscribe('login', login);\n        return () => {\n            PubSub.unsubscribe('login');\n            PubSub.unsubscribe('logout');\n        }  // eslint-disable-next-line\n    }, []);\n\n    useEffect(() => {\n        const token = getToken();\n        if (token) {\n            axios({\n                method: 'GET',\n                url: 'http://localhost:3001/server/verify',\n                headers: {\n                    Authorization: token\n                }\n            }).then((response) => {\n                if (response.data.status === 200) {\n                    localStorage.setItem('token', response.data.token);\n                    setUser(response.data.data);\n                } else if (response.data.status === 401) {\n                    removeToken();\n                } else {\n                    props.history.push('/error');\n                }\n            });\n        }\n    }, []);\n\n    const logout = () => {\n        removeToken();\n        setUser(undefined);\n    }\n\n    const login = (message, user) => {\n        setUser(user);\n    }\n\n    return (\n        <>\n            <Layout className=\"layout\" style={{minHeight: '100vh'}}>\n                <MyHeader user={user} />\n                <Content style={{ width: '1000px', margin: '0 auto'}}>\n                    <div className=\"site-layout-content\">\n                        <Suspense fallback={<Skeleton />}>\n                            {renderRoutes(routes)}\n                        </Suspense>\n                    </div>\n                </Content>\n                <Footer style={{ textAlign: 'center', height: '150px' }}>718音乐 ©2021 Created by YWJ</Footer>\n            </Layout>\n            <PlayBar user={user} />\n        </>\n    );\n}\n\nexport default withRouter(App);"]},"metadata":{},"sourceType":"module"}